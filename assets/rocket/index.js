window.__require=function t(o,e,r){function i(c,a){if(!e[c]){if(!o[c]){var l=c.split("/");if(l=l[l.length-1],!o[l]){var d="function"==typeof __require&&__require;if(!a&&d)return d(l,!0);if(n)return n(l,!0);throw new Error("Cannot find module '"+c+"'")}c=l}var s=e[c]={exports:{}};o[c][0].call(s.exports,function(t){return i(o[c][1][t]||t)},s,s.exports,t,o,e,r)}return e[c].exports}for(var n="function"==typeof __require&&__require,c=0;c<r.length;c++)i(r[c]);return i}({rocket:[function(t,o,e){"use strict";cc._RF.push(o,"036ebjj6pxHQ5T08XFmxWQH","rocket");var r,i=this&&this.__extends||(r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),n=this&&this.__decorate||function(t,o,e,r){var i,n=arguments.length,c=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(n<3?i(c):n>3?i(o,e,c):i(o,e))||c);return n>3&&c&&Object.defineProperty(o,e,c),c};Object.defineProperty(e,"__esModule",{value:!0}),e.STICK_CHOICE_WRONG=e.STICK_CHOICE_CORRECT=void 0;var c=cc._decorator.ccclass,a=cc._decorator.property,l=cc.BoxCollider,d=cc.Layout,s=t("../../../common/scripts/lib/config"),p=t("../../../common/scripts/util"),u=t("../../../common/scripts/drag"),h=t("./sticker-choice"),f=t("../../../common/scripts/lib/error-handler"),y=t("../../../common/scripts/Utility"),_=t("../../../common/scripts/game");e.STICK_CHOICE_CORRECT="stickChoiceCorrect",e.STICK_CHOICE_WRONG="stickChoiceWrong";var C=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o._currentConfig=null,o.wordNoteBoardPrefab=null,o.dropContainerPrefab=null,o.choiceContainerPrefab=null,o.choiceContainerOneRowPrefab=null,o.rocketheadPrefab=null,o.rockettailPrefab=null,o.stickerPrefab=null,o.stickerDropPrefab=null,o.soundBtnPrefab=null,o.imageNodePrefab=null,o._wordNoteBoard=null,o._dropLayout=null,o._loadedTexture=null,o._totalDrops=0,o._rocketHead=null,o._rocketTail=null,o._dropContainer=null,o._mWord=[],o._choiceContainers=[],o._helpDragNode=null,o._helpDropNode=null,o._helpWord=null,o._isRTL=!1,o}return i(o,t),o.prototype.onLoad=function(){this._isRTL=s.default.i.direction==s.Direction.RTL,cc.director.getCollisionManager().enabled=!0,u.default.letDrag=!0,this._currentConfig=this.processConfiguration(s.default.getInstance().data[0]);var t=new Date;this.buildUI(),p.Util.computeTimeDiff("wordnote buildUI",t)},o.prototype.buildUI=function(){var t=this;if(this.buildWordNoteBoard(),this.buildDropContainer(),this._mWord=this.diff(this._currentConfig.card,this._currentConfig.activeCard),"true"===this._currentConfig.fullboard||"true"===this._currentConfig.partialboard)for(var o=1;o<=2;o++){var r=this.buildChoiceContainerSingleRow(o);this._choiceContainers.push(r)}else r=this.buildChoiceContainer(1),this._choiceContainers.push(r);try{p.Util.loadGameSound(this._currentConfig.sound,function(o){t.friend.extraClip=o})}catch(i){}this.node.on(e.STICK_CHOICE_CORRECT,this.stickCorrect.bind(this)),this.node.on(e.STICK_CHOICE_WRONG,this.stickWrong.bind(this)),this.scheduleOnce(function(){t._choiceContainers.forEach(function(t){return t.opacity=255})},.1),this.scheduleOnce(function(){p.Util.showHelp(t._helpDragNode,t._helpDropNode)},.5)},o.prototype.loadTexture=function(){var t=this;p.Util.loadTexture(this._currentConfig.image,function(o){t.showImage(o)})},o.prototype.showImage=function(t){var o=this._wordNoteBoard.getChildByName("imageNode").getComponent(cc.Sprite);o.spriteFrame=new cc.SpriteFrame(t),p.Util.resizeSprite(o,160,160)},o.prototype.buildWordNoteBoard=function(){this._wordNoteBoard=cc.instantiate(this.wordNoteBoardPrefab);var t=this._wordNoteBoard.getChildByName("label"),o=t.getComponent(cc.Label);t.addComponent(cc.LabelOutline).width=2,o.string=this._currentConfig.word,this._wordNoteBoard.setPosition(new cc.Vec2(0,263)),this.loadTexture(),this.checkRTLAndScaleX(this._wordNoteBoard,1),this.checkRTLAndScaleX(t,1),this.node.addChild(this._wordNoteBoard)},o.prototype.buildDropContainer=function(){this._dropContainer=cc.instantiate(this.dropContainerPrefab),this._dropContainer.setPosition(new cc.Vec2(-80,25)),this._isRTL&&(this._dropContainer.setPosition(new cc.Vec2(80,25)),this.checkRTLAndScaleX(this._dropContainer,1)),this._dropLayout=this._dropContainer.getChildByName("dropLayout"),this.addChildrenToDropLayout(this._dropLayout,this.stickerDropPrefab),this.node.addChild(this._dropContainer)},o.prototype.addChildrenToDropLayout=function(t,o){this._rocketHead=cc.instantiate(this.rocketheadPrefab),this.friendPos.removeFromParent(),this.friendPos.position=cc.Vec3.ZERO,this._rocketHead.getChildByName("character_node").getChildByName("dog").addChild(this.friendPos),t.addChild(this._rocketHead);var e="en/"===s.default.dir?this._currentConfig.word.split(""):this._currentConfig.activeCard.split(","),r=this._currentConfig.card.split(","),i="true"===this._currentConfig.fullboard||"true"===this._currentConfig.partialboard?e:r;this.buildWords(t,i||[],o,!0),this._rocketTail=cc.instantiate(this.rockettailPrefab),t.addChild(this._rocketTail)},o.prototype.createSticker=function(t,o,e,r,i,n){var c=i?cc.instantiate(i):t.getChildByName("sticker"+o);i&&t.addChild(c),c.getComponent(l).size=new cc.Size(c.width,c.height);var a=c.getChildByName("label");a.color=cc.Color.WHITE;var d=a.addComponent(cc.LabelOutline);if(d.width=3,d.color=cc.Color.BLACK,a){var s=a.getComponent(cc.Label);if(a.width=1*s.fontSize,r?(c.color=cc.Color.GRAY,a.opacity=0,this._totalDrops++):c.color=(new cc.Color).fromHEX("#"+Math.floor(16777215*Math.random()).toString(16)),!r){var p=c.getComponent(h.default);p.word=e,p.name=e,p.allowDrag=n,a.opacity=n?255:128}c.width=a.width,s&&(c.name=e,s.string=e)}return c},o.prototype.buildWords=function(t,o,e,r){var i=this;void 0===r&&(r=!1),o.forEach(function(o,n){i._helpWord||(i._helpWord=o);var c=!0;"true"!==i._currentConfig.partialboard||"true"===i._currentConfig.fullboard||r||(c=i._currentConfig.activeCard.includes(o));var a=i.createSticker(t,n+1,o,r,e,c);if(r)i._helpWord===o&&(i._helpDropNode=a);else{if(i._helpWord===o&&(i._helpDragNode=a),i._isRTL){var l=new cc.Node;l.name="shouldFlip",a.addChild(l)}a.on("stickChoice",function(){i._totalDrops--,i.node.emit("correct"),0===i._totalDrops&&i.scheduleOnce(function(){i.playSuccessAnimation()},1)}),a.on("stickNoChoice",function(){i.node.emit("wrong")})}})},o.prototype.stickCorrect=function(t){t.stopPropagation(),this._totalDrops--,this.node.emit("correct"),0===this._totalDrops&&(this._choiceContainers.forEach(function(t){t.pauseSystemEvents(!0)}),this.friend.speakExtra(this.playSuccessAnimation.bind(this)))},o.prototype.stickWrong=function(t){t.stopPropagation(),this.node.emit("wrong")},o.prototype.moveToNext=function(){this.node.emit("nextProblem")},o.prototype.playSuccessAnimation=function(){var t=this;this._rocketTail.getChildByName("fire").getComponent(cc.Animation).play("fire"),this.scheduleOnce(function(){(new cc.Tween).target(t._dropContainer).to(1.5,{x:(cc.winSize.width+100)*(t._isRTL?1:-1)},{progress:null,easing:"quadOut"}).call(function(){t.moveToNext()}).start()},1)},o.prototype.removeDuplicateCharacters=function(t){return t.replace(/[\s\S](?=([\s\S]+))/g,function(t,o){return o.indexOf(t)+1?"":t})},o.prototype.diff=function(t,o){var e="en/"===s.default.dir?this._currentConfig.word.split(""):o.split(","),r=t.split(",").filter(function(t){return!o.includes(t)});return p.Util.shuffle(e.concat(r).slice(0,26))},o.prototype.addChildrenToChoiceLayout=function(t,o,e){var r=this.buildShowWords(t);this.buildWords(o,r||[],e,!1)},o.prototype.buildChoiceContainerSingleRow=function(t){var o=cc.instantiate(this.choiceContainerOneRowPrefab);return this.addChoiceContainerToNode(o,t,!1),o},o.prototype.addChoiceContainerToNode=function(t,o,e){void 0===e&&(e=!1),t.opacity=0,t.name="choiceContainer"+o,t.setPosition(new cc.Vec2(0,-150*o+50*(o-1)));var r=t.getChildByName("choiceLayout");e?this.addChildrenToChoiceLayout(o,r,this.stickerPrefab):this.addChildrenToChoiceLayoutSingleRow(o,r),r.name="choiceLayout"+o,this.node.addChild(t),this.updateChoiceLayout(r)},o.prototype.checkRTLAndScaleX=function(t,o){t.scaleX=this._isRTL?-o:o},o.prototype.buildShowWords=function(t){var o="true"===this._currentConfig.fullboard||"true"===this._currentConfig.partialboard?p.Util.chunk(this._mWord,Math.floor(this._mWord.length/2)):p.Util.shuffle(this._currentConfig.activeCard.split(","));return"true"===this._currentConfig.fullboard||"true"===this._currentConfig.partialboard?o[t-1]:o},o.prototype.addChildrenToChoiceLayoutSingleRow=function(t,o){var e=this.buildShowWords(t);this.buildWords(o,e||[],null,!1)},o.prototype.buildChoiceContainer=function(t){var o=cc.instantiate(this.choiceContainerPrefab);return this.addChoiceContainerToNode(o,t,!0),o},o.prototype.updateChoiceLayout=function(t){this.scheduleOnce(function(){t.getComponent(cc.Layout).type=d.Type.NONE},.05)},o.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var o=[].concat.apply([],t),e=o[0],r=o[1],i=o[2],n=o[3],c=o[4],a=o[5],l=o[6],d=o[7],p=o[8],u=o[9];return 0===c.length&&(c=y.AlphabetUtil.getRandomConsonantArray(s.default.dir).join(",")),{level:e,worksheet:r,problem:i,word:n,card:c,activeCard:a,sound:l,image:d,partialboard:p,fullboard:u}},n([a(cc.Prefab)],o.prototype,"wordNoteBoardPrefab",void 0),n([a(cc.Prefab)],o.prototype,"dropContainerPrefab",void 0),n([a(cc.Prefab)],o.prototype,"choiceContainerPrefab",void 0),n([a(cc.Prefab)],o.prototype,"choiceContainerOneRowPrefab",void 0),n([a(cc.Prefab)],o.prototype,"rocketheadPrefab",void 0),n([a(cc.Prefab)],o.prototype,"rockettailPrefab",void 0),n([a(cc.Prefab)],o.prototype,"stickerPrefab",void 0),n([a(cc.Prefab)],o.prototype,"stickerDropPrefab",void 0),n([a(cc.Prefab)],o.prototype,"soundBtnPrefab",void 0),n([a(cc.Prefab)],o.prototype,"imageNodePrefab",void 0),n([f.default()],o.prototype,"onLoad",null),n([f.default()],o.prototype,"buildUI",null),n([f.default()],o.prototype,"loadTexture",null),n([f.default()],o.prototype,"showImage",null),n([f.default()],o.prototype,"buildWordNoteBoard",null),n([f.default()],o.prototype,"buildDropContainer",null),n([f.default()],o.prototype,"addChildrenToDropLayout",null),n([f.default()],o.prototype,"createSticker",null),n([f.default()],o.prototype,"buildWords",null),n([f.default()],o.prototype,"stickCorrect",null),n([f.default()],o.prototype,"stickWrong",null),n([f.default()],o.prototype,"moveToNext",null),n([f.default()],o.prototype,"playSuccessAnimation",null),n([f.default()],o.prototype,"removeDuplicateCharacters",null),n([f.default()],o.prototype,"diff",null),n([f.default()],o.prototype,"addChildrenToChoiceLayout",null),n([f.default()],o.prototype,"buildChoiceContainerSingleRow",null),n([f.default()],o.prototype,"addChoiceContainerToNode",null),n([f.default()],o.prototype,"checkRTLAndScaleX",null),n([f.default()],o.prototype,"buildShowWords",null),n([f.default()],o.prototype,"addChildrenToChoiceLayoutSingleRow",null),n([f.default()],o.prototype,"buildChoiceContainer",null),n([f.default()],o.prototype,"updateChoiceLayout",null),n([c],o)}(_.default);e.default=C,cc._RF.pop()},{"../../../common/scripts/Utility":void 0,"../../../common/scripts/drag":void 0,"../../../common/scripts/game":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./sticker-choice":"sticker-choice"}],"sticker-choice":[function(t,o,e){"use strict";cc._RF.push(o,"68357KHZmdHJYH5e+nGeKY1","sticker-choice");var r,i=this&&this.__extends||(r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),n=this&&this.__decorate||function(t,o,e,r){var i,n=arguments.length,c=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(n<3?i(c):n>3?i(o,e,c):i(o,e))||c);return n>3&&c&&Object.defineProperty(o,e,c),c};Object.defineProperty(e,"__esModule",{value:!0});var c=t("../../../common/scripts/drag"),a=t("./rocket"),l=cc._decorator.ccclass,d=cc._decorator.property,s=t("../../../common/scripts/util"),p=t("../../../common/scripts/lib/error-handler"),u=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o._originalPosition=null,o.name="",o.word="",o.correctClip=null,o.wrongClip=null,o}return i(o,t),o.prototype.onLoad=function(){t.prototype.onLoad.call(this)},o.prototype.start=function(){t.prototype.start.call(this)},o.prototype.onTouchStart=function(o){t.prototype.onTouchStart.call(this,o),this._originalPosition=this.node.position;try{s.Util.speakPhonicsOrLetter(this.word||this.name,function(){})}catch(e){}},o.prototype.onTouchMove=function(o){t.prototype.onTouchMove.call(this,o)},o.prototype.returnBackOnNoMatchPos=function(){try{this.wrongClip&&s.Util.playSfx(this.wrongClip)}catch(t){}return this._originalPosition?this._originalPosition:this.node.position},o.prototype.onTouchEnd=function(o){t.prototype.onTouchEnd.call(this,o),this.match?this.node.dispatchEvent(new cc.Event.EventCustom(a.STICK_CHOICE_CORRECT,!0)):this.allowDrag&&this.isMoved&&this.node.dispatchEvent(new cc.Event.EventCustom(a.STICK_CHOICE_WRONG,!0))},o.prototype.onMatchOver=function(){t.prototype.onMatchOver.call(this)},n([d(cc.AudioClip)],o.prototype,"correctClip",void 0),n([d(cc.AudioClip)],o.prototype,"wrongClip",void 0),n([p.default()],o.prototype,"onLoad",null),n([l],o)}(c.default);e.default=u,cc._RF.pop()},{"../../../common/scripts/drag":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./rocket":"rocket"}],"sticker-drop":[function(t,o,e){"use strict";cc._RF.push(o,"469d0J683hPaKec5sFv8XZs","sticker-drop");var r,i=this&&this.__extends||(r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),n=this&&this.__decorate||function(t,o,e,r){var i,n=arguments.length,c=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(n<3?i(c):n>3?i(o,e,c):i(o,e))||c);return n>3&&c&&Object.defineProperty(o,e,c),c};Object.defineProperty(e,"__esModule",{value:!0});var c=t("../../../common/scripts/drop"),a=cc._decorator.ccclass,l=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return i(o,t),o.prototype.onMatchOver=function(){t.prototype.onMatchOver.call(this),this.node.opacity=255},n([a],o)}(c.default);e.default=l,cc._RF.pop()},{"../../../common/scripts/drop":void 0}],"word-sound-button":[function(t,o,e){"use strict";cc._RF.push(o,"06bd7Dt3iFGwLj+Z+8zj0OH","word-sound-button");var r,i=this&&this.__extends||(r=function(t,o){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(t[e]=o[e])})(t,o)},function(t,o){function e(){this.constructor=t}r(t,o),t.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}),n=this&&this.__decorate||function(t,o,e,r){var i,n=arguments.length,c=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,e):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,e,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(n<3?i(c):n>3?i(o,e,c):i(o,e))||c);return n>3&&c&&Object.defineProperty(o,e,c),c};Object.defineProperty(e,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=t("../../../common/scripts/lib/error-handler"),l=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o._isSoundPlaying=!1,o}return i(o,t),o.prototype.playSound=function(){this._isSoundPlaying||(this._isSoundPlaying=!0,this.containerComponent.speakWord())},o.prototype.stopSound=function(){this._isSoundPlaying=!1,cc.audioEngine.stopAllEffects()},o.prototype.soundOnLoad=function(){this.playSound()},o.prototype.onButtonClick=function(t){t.target,this.stopSound(),this.playSound()},o.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects()},n([a.default()],o.prototype,"playSound",null),n([a.default()],o.prototype,"stopSound",null),n([a.default()],o.prototype,"soundOnLoad",null),n([a.default()],o.prototype,"onButtonClick",null),n([c],o)}(cc.Component);e.default=l,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0}]},{},["rocket","sticker-choice","sticker-drop","word-sound-button"]);