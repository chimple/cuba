window.__require=function e(t,o,n){function r(i,c){if(!o[i]){if(!t[i]){var a=i.split("/");if(a=a[a.length-1],!t[a]){var l="function"==typeof __require&&__require;if(!c&&l)return l(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+i+"'")}i=a}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return r(t[i][1][e]||e)},u,u.exports,e,t,o,n)}return o[i].exports}for(var s="function"==typeof __require&&__require,i=0;i<n.length;i++)r(n[i]);return r}({assignmentPopup:[function(e,t,o){"use strict";cc._RF.push(t,"fb2e2rrH3tCDpnAilQG3MVL","assignmentPopup");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("./chapterLessons"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text=null,t.yesButton=null,t.block=null,t.dialog=null,t.msg=null,t}return r(t,e),t.prototype.onLoad=function(){},t.prototype.onEnable=function(){this.dialog.active=!0,this.block.active=!0},t.prototype.onDisable=function(){this.dialog.active=!1,this.block.active=!1},t.prototype.onClickYes=function(){c.default.showType=c.ChapterLessonType.Assignments,i.default.i.pushScene("menu/start/scenes/chapterLessons","menu")},t.prototype.onClickNo=function(){this.dialog.active=!1,this.block.active=!1,this.node.active=!1},s([u(cc.Node)],t.prototype,"text",void 0),s([u(cc.Node)],t.prototype,"yesButton",void 0),s([u(cc.Node)],t.prototype,"block",void 0),s([u(cc.Node)],t.prototype,"dialog",void 0),s([u(cc.Node)],t.prototype,"msg",void 0),s([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"./chapterLessons":"chapterLessons"}],chapterContent:[function(e,t,o){"use strict";cc._RF.push(t,"44799QSQ/dBoaNm8rQ2ydtk","chapterContent");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,a=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.layout=null,t}return r(t,e),t.prototype.start=function(){this.layout.getComponent(cc.Layout).updateLayout(),this.layout.parent.width=this.layout.width},s([a(cc.Label)],t.prototype,"label",void 0),s([a(cc.Node)],t.prototype,"layout",void 0),s([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{}],chapterLessons:[function(e,t,o){"use strict";cc._RF.push(t,"0509cXbc2xOGKT4rGZRbk/1","chapterLessons");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0}),o.ChapterLessonType=void 0;var i,c=e("../../../common/scripts/lib/config"),a=e("./lessonButton"),l=e("../../../common/scripts/lib/profile"),u=e("../../../common/scripts/util"),p=cc._decorator,d=p.ccclass,h=p.property,f={en:"#FFBC00",maths:"#42C0FF",hi:"#009158",puzzle:"#FF5500","test-lit":"#FFBC00","test-maths":"#42C0FF"};(function(e){e[e.Library=0]="Library",e[e.Assignments=1]="Assignments",e[e.Featured=2]="Featured"})(i=o.ChapterLessonType||(o.ChapterLessonType={}));var g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lessonButtonPrefab=null,t.layout=null,t.label=null,t.loading=null,t.bgHolder=null,t.header=null,t.whatsappNode=null,t.otpDialogNode=null,t}var o;return r(t,e),o=t,t.prototype.onLoad=function(){var e=this;this.node.getChildByName("block").active=!0,this.bgHolder.removeAllChildren(),l.User.getCurrentUser().currentBg?this.setBackground(l.User.getCurrentUser().currentBg):this.setBackground("camp");var t=c.default.i;switch(o.showType){case i.Assignments:l.User.getCurrentUser().isConnected?(this.label.string="Assignments",t.getAssignmentLessonsTodo().forEach(function(t){e.createLessonButton(t,!0)})):this.label.string="Connect To Class";break;case i.Featured:this.label.string="Featured",t.featuredLessons.forEach(function(o){if(!l.User.getCurrentUser().lessonProgressMap.get(o.id)){var n=c.default.i.allLessons.get(o.id);if(n)e.createLessonButton(n,!0);else{var r=t.curriculum.get(o.course);r&&(o.chapter={id:r.id+"_featured",lessons:[],name:r.name,image:"",course:r}),e.createLessonButton(o,!0)}}});break;case i.Library:default:this.label.string=t.chapter.name,t.chapter.lessons.forEach(function(o,n){e.createLessonButton(o,"reward"==o.chapter.course.id?1==l.User.getCurrentUser().unlockedRewards[u.REWARD_TYPES[4]+"-"+t.chapter.id+"-"+o.id]:0==n||o.open||l.User.getCurrentUser().lessonProgressMap.has(o.id))})}this.layout.width=cc.winSize.width,this.layout.parent.width=cc.winSize.width,this.layout.parent.parent.width=cc.winSize.width,this.layout.getComponent(cc.Layout).updateLayout(),this.layout.parent.height=this.layout.height;var n=f[t.course.id];n&&(this.header.color=(new cc.Color).fromHEX(n))},t.prototype.createLessonButton=function(e,t){var o=cc.instantiate(this.lessonButtonPrefab),n=o.getComponent(a.default);n.lesson=e,n.loading=this.loading,n.open=t,this.layout.addChild(o)},t.prototype.setBackground=function(e){var t=this;cc.resources.load("backgrounds/prefabs/"+e,function(e,o){var n=cc.instantiate(o);n.y=0,n.x=0,t.bgHolder&&null!=n&&t.bgHolder.addChild(n)})},t.prototype.onBackClick=function(){c.default.i.popScene()},t.prototype.onWhatsappClick=function(){cc.sys.openURL("https://wa.me/919845206203?text="+l.User.getCurrentUser().id)},t.prototype.start=function(){this.node.getChildByName("block").active=!1},t.showType=i.Library,s([h(cc.Prefab)],t.prototype,"lessonButtonPrefab",void 0),s([h(cc.Node)],t.prototype,"layout",void 0),s([h(cc.Label)],t.prototype,"label",void 0),s([h(cc.Node)],t.prototype,"loading",void 0),s([h(cc.Node)],t.prototype,"bgHolder",void 0),s([h(cc.Node)],t.prototype,"header",void 0),s([h(cc.Node)],t.prototype,"whatsappNode",void 0),s([h(cc.Node)],t.prototype,"otpDialogNode",void 0),o=s([d],t)}(cc.Component);o.default=g,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0,"./lessonButton":"lessonButton"}],chapterMenuButton:[function(e,t,o){"use strict";cc._RF.push(t,"0180cvk8A1LV7TLG+aOmJgN","chapterMenuButton");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("../../../common/scripts/lib/profile"),a=e("../../../common/scripts/chapterIcon"),l=cc._decorator,u=l.ccclass,p=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.graphics=null,t.open=!0,t}return r(t,e),t.prototype.onLoad=function(){var e=this;if(null!=this.chapter){var t=i.default.i,o=cc.instantiate(this.chapterIconPrefab),n=o.getComponent(a.default);n.chapter=this.chapter,n.open=this.open,this.button.node.insertChild(o,0),this.label.string=this.chapter.name,this.button.node.on("touchend",function(o){o.target.getComponent(cc.Button).interactable&&(t.chapter=e.chapter,t.pushScene("menu/start/scenes/chapterLessons","menu"))}),this.button.interactable=this.open;var r=this.chapter.lessons.filter(function(e){var t=c.User.getCurrentUser().lessonProgressMap.get(e.id);if(t&&t.score>=0)return!0}).length/this.chapter.lessons.length*Math.PI*2;this.graphics.arc(0,0,56,1*Math.PI/2,-r+1*Math.PI/2),this.graphics.stroke(),this.currentChapterIcon.active=c.User.getCurrentUser().courseProgressMap.get(this.chapter.course.id).currentChapterId==this.chapter.id}},s([p(cc.Label)],t.prototype,"label",void 0),s([p(cc.Button)],t.prototype,"button",void 0),s([p(cc.Graphics)],t.prototype,"graphics",void 0),s([p(cc.Prefab)],t.prototype,"chapterIconPrefab",void 0),s([p(cc.Node)],t.prototype,"currentChapterIcon",void 0),s([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../../../common/scripts/chapterIcon":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/profile":void 0}],courseChapters:[function(e,t,o){"use strict";cc._RF.push(t,"cdf75lC/IFHCpbwumT2/QOh","courseChapters");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("../../../common/scripts/lib/profile"),a=e("./chapterMenuButton"),l=e("../../../common/scripts/util"),u=cc._decorator,p=u.ccclass,d=u.property,h={en:"#FFBC00",maths:"#42C0FF",hi:"#009158",puzzle:"#FF5500","test-lit":"#FFBC00","test-maths":"#42C0FF"},f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lessonButtonPrefab=null,t.chaptersLayout=null,t.chapterMenuButtonPrefab=null,t.title=null,t.loading=null,t.bgHolder=null,t.header=null,t}return r(t,e),t.prototype.onLoad=function(){this.node.getChildByName("block").active=!0,this.setBackground();var e=i.default.i;this.title.string=l.Util.i18NText(e.course.name);for(var t=0,o=e.course.chapters;t<o.length;t++){var n=o[t];if(n.id!=e.course.id+"_quiz"){var r=cc.instantiate(this.chapterMenuButtonPrefab);r.getComponent(a.default).chapter=n,this.chaptersLayout.addChild(r)}}this.chaptersLayout.width=cc.winSize.width,this.chaptersLayout.parent.width=cc.winSize.width,this.chaptersLayout.parent.parent.width=cc.winSize.width,this.chaptersLayout.getComponent(cc.Layout).updateLayout(),this.chaptersLayout.parent.height=this.chaptersLayout.height;var s=h[e.course.id];s&&(this.header.color=(new cc.Color).fromHEX(s))},t.prototype.start=function(){this.node.getChildByName("block").active=!1},t.prototype.setBackground=function(){var e=this;this.bgHolder.removeAllChildren();var t=c.User.getCurrentUser().currentBg?c.User.getCurrentUser().currentBg:"camp";cc.resources.load("backgrounds/prefabs/"+t,function(t,o){var n=cc.instantiate(o);n.y=0,n.x=0,e.bgHolder.addChild(n)})},s([d(cc.Prefab)],t.prototype,"lessonButtonPrefab",void 0),s([d(cc.Node)],t.prototype,"chaptersLayout",void 0),s([d(cc.Prefab)],t.prototype,"chapterMenuButtonPrefab",void 0),s([d(cc.Label)],t.prototype,"title",void 0),s([d(cc.Node)],t.prototype,"loading",void 0),s([d(cc.Node)],t.prototype,"bgHolder",void 0),s([d(cc.Node)],t.prototype,"header",void 0),s([p],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0,"./chapterMenuButton":"chapterMenuButton"}],courseContent:[function(e,t,o){"use strict";cc._RF.push(t,"d91c0gXhclDD6RZOzsKPeTI","courseContent");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("./chapterMenuButton"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lessonButtonPrefab=null,t.chaptersLayout=null,t.chapterMenuButtonPrefab=null,t}return r(t,e),t.prototype.onLoad=function(){for(var e=0,t=i.default.i.course.chapters;e<t.length;e++){var o=t[e],n=cc.instantiate(this.chapterMenuButtonPrefab),r=n.getComponent(c.default);r.chapter=o,r.content=this.content,r.loading=this.loading,this.chaptersLayout.addChild(n)}this.chaptersLayout.width=cc.winSize.width,this.chaptersLayout.parent.width=cc.winSize.width,this.chaptersLayout.parent.parent.width=cc.winSize.width,this.chaptersLayout.getComponent(cc.Layout).updateLayout(),this.chaptersLayout.parent.height=this.chaptersLayout.height},s([u(cc.Prefab)],t.prototype,"lessonButtonPrefab",void 0),s([u(cc.Node)],t.prototype,"chaptersLayout",void 0),s([u(cc.Prefab)],t.prototype,"chapterMenuButtonPrefab",void 0),s([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"./chapterMenuButton":"chapterMenuButton"}],drawer:[function(e,t,o){"use strict";cc._RF.push(t,"1c9d9TGdjxC9JGBtPPplkAO","drawer");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/profile"),c=e("../../../common/scripts/lib/config"),a=e("../../../common/scripts/util"),l=e("../../../common/scripts/headerButton"),u=e("../../../common/scripts/header"),p=cc._decorator,d=p.ccclass,h=p.property,f={en:"#FFBC00",maths:"#42C0FF",hi:"#009158",kn:"#BD1F32",mr:"#BD1F32",puzzle:"#FF5500","test-lit":"#FFBC00","test-maths":"#42C0FF"},g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.courseLayout=null,t.drawerButtonPrefab=null,t.block=null,t.left=null,t}return r(t,e),t.prototype.onLoad=function(){var e=this,t=c.default.i;this.left.x=-cc.winSize.width/2,i.User.getCurrentUser().courseProgressMap.forEach(function(o,n){var r=cc.instantiate(e.drawerButtonPrefab),s=r.getComponent(l.default),i=t.curriculum.get(n);t.course.id!=i.id&&(e.courseLayout.addChild(r),s.label.string=a.Util.i18NText(i.name));var p=f[n];p&&(s.selected.node.color=(new cc.Color).fromHEX(p)),a.Util.load(n+"/course/res/icons/"+n+".png",function(e,t){s.sprite.spriteFrame=e?null:new cc.SpriteFrame(t)}),s.button.node.on("touchend",function(e){e.target.getComponent(cc.Button).enabled&&(t.course.id==i.id?t.pushScene("menu/start/scenes/courseChapters","menu"):(t.course=i,c.default.loadScene("menu/start/scenes/start","menu")))}),!u.default.homeSelected&&t.course&&t.course.id==i.id&&e.selectHeaderButton(s)}),this.node.width=cc.winSize.width;var o=Math.max(0,(this.courseLayout.width-this.courseLayout.childrenCount*this.courseLayout.children[0].width)/(this.courseLayout.childrenCount+1));this.courseLayout.getComponent(cc.Layout).spacingX=o,this.courseLayout.getComponent(cc.Layout).paddingLeft=o,this.courseLayout.getComponent(cc.Layout).paddingRight=o},t.prototype.selectHeaderButton=function(e){null!=this.selectedHeaderButton&&(this.selectedHeaderButton.selected.node.active=!1,this.selectedHeaderButton.button.enabled=!0),e.selected.node.active=!0,e.button.enabled=!1,this.selectedHeaderButton=e},t.prototype.onEnable=function(){var e=this;this.block.active=!0,this.block.on("touchend",function(){e.closeDrawer()}),(new cc.Tween).target(this.left).to(.5,{x:-cc.winSize.width/2+320},{progress:null,easing:"cubicInOut"}).start()},t.prototype.closeDrawer=function(){var e=this;(new cc.Tween).target(this.left).to(.5,{x:-cc.winSize.width/2},{progress:null,easing:"cubicInOut"}).call(function(){e.node.active=!1}).start()},s([h(cc.Node)],t.prototype,"courseLayout",void 0),s([h(cc.Prefab)],t.prototype,"drawerButtonPrefab",void 0),s([h(cc.Node)],t.prototype,"block",void 0),s([h(cc.Node)],t.prototype,"left",void 0),s([d],t)}(cc.Component);o.default=g,cc._RF.pop()},{"../../../common/scripts/header":void 0,"../../../common/scripts/headerButton":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0}],home:[function(e,t,o){"use strict";cc._RF.push(t,"e8ad40c/lZIVay1x6a995wv","home");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("../../../common/scripts/lib/profile"),a=e("../../../common/scripts/util"),l=e("../../../common/scripts/util-logger"),u=e("../../../common/scripts/balloon"),p=e("../../../common/scripts/lib/constants"),d=cc._decorator,h=d.ccclass,f=d.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.nestPrefab=null,t.balloons=null,t.balloonPrefab=null,t.loadingPrefab=null,t.logo=null,t.nest=null,t.bgMusic=null,t}return r(t,e),t.prototype.onLoad=function(){var e=this,t=i.default.getInstance();l.default.initPluginFirebase(),cc.sys.isNative&&jsb.fileUtils.setSearchPaths([jsb.fileUtils.getWritablePath()+"subpackages",jsb.fileUtils.getWritablePath()+"HotUpdateSearchPaths","@assets/subpackages/","@assets/"]);var o=Object.assign({});o[""+p.LOG_TYPE]=p.APP_START,l.default.logEvent(o),a.Util.playSfx(this.bgMusic,!0,!0);var n=this.logo.y;(new cc.Tween).target(this.logo).set({y:cc.winSize.height}).to(1,{y:n},{progress:null,easing:"elasticOut"}).start(),["en","en-maths"].forEach(function(o,n,r){var s=cc.instantiate(e.balloonPrefab),i=s.getComponent(u.default);if(i.chimp=e.nest.getChildByName("chimp"),i.type=u.BalloonType.Type,i.game=o,i.onClickCallback=function(){var o=e.node.getChildByName("nest");if(null!=o){var n=o.getChildByName("home");if(null!=n){var r=n.getComponent(cc.Button);null!=r&&(r.interactable=!1)}}t.pushScene("menu/map/scene/map"+c.default.lastWorld.toString(),"menu")},s.scale=.8,r.length>2){var a=e.balloons.getComponent(cc.Layout);null!=a&&(a.spacingX=50)}var l=new cc.Node;l.width=.8*s.width,l.addChild(s),e.balloons.addChild(l),(new cc.Tween).target(s).set({y:cc.winSize.height}).delay(1).to(1,{y:0},{progress:null,easing:"elasticOut"}).start()});var r=cc.director.getScene().getChildByName("loading");if(null==r){var s=cc.instantiate(this.loadingPrefab);s.zIndex=3,cc.game.addPersistRootNode(s),s.active=!1}else r.active=!1},t.prototype.nextFlow=function(){},t.prototype.onInventoryButtonClicked=function(){i.default.getInstance().pushScene("rewards")},t.prototype.onDestroy=function(){cc.audioEngine.stopMusic()},s([f(cc.Prefab)],t.prototype,"nestPrefab",void 0),s([f(cc.Node)],t.prototype,"balloons",void 0),s([f(cc.Prefab)],t.prototype,"balloonPrefab",void 0),s([f(cc.Prefab)],t.prototype,"loadingPrefab",void 0),s([f(cc.Node)],t.prototype,"logo",void 0),s([f(cc.Node)],t.prototype,"nest",void 0),s([f(cc.AudioClip)],t.prototype,"bgMusic",void 0),s([h],t)}(cc.Component);o.default=g,cc._RF.pop()},{"../../../common/scripts/balloon":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/constants":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0,"../../../common/scripts/util-logger":void 0}],hotUpdate:[function(e,t,o){"use strict";cc._RF.push(t,"1eddd6WqopBsqESK/HdMEPs","hotUpdate");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0}),o.PROJECT_MANIFEST=o.UpdateEvent=void 0;var i,c=e("../../../common/scripts/util"),a=e("../../../common/scripts/util-logger"),l=cc._decorator,u=l.ccclass,p=l.property;(function(e){e[e.Checking=0]="Checking",e[e.Updating=1]="Updating",e[e.UpdateDone=2]="UpdateDone",e[e.Done=3]="Done",e[e.Error=4]="Error"})(i=o.UpdateEvent||(o.UpdateEvent={})),o.PROJECT_MANIFEST="project.manifest";var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.status=null,t.fileProgress=null,t.manifest=null,t}var o;return r(t,e),o=t,t.prototype.oneByOne=function(e,t,n){var r=this;o.doHotUpdate(e[t].storagePath,e[t].manifestUrl,null,function(o,s,c){r.status.string=s,r.fileProgress.progress=c,o!=i.Done&&o!=i.UpdateDone&&o!=i.Error||(n(t,o==i.UpdateDone&&"HotUpdateSearchPaths"==e[t].storagePath),++t<e.length&&r.oneByOne(e,t,n))})},t.prototype.onLoad=function(){if(a.default.initPluginFirebase(),cc.sys.isNative){var e=[{storagePath:"HotUpdateSearchPaths",manifestUrl:this.manifest.nativeUrl}],t=c.Util.getSubpackages().map(function(e){return{storagePath:t+"/"+e,manifestUrl:e+"/project.manifest"}}),o=!1;this.oneByOne(e,0,function(t,n){o=o||n,t==e.length-1&&(o?(cc.audioEngine.stopAll(),cc.game.restart()):cc.director.loadScene("home"))})}else cc.director.loadScene("home")},t.doHotUpdate=function(e,t,o,n){var r=(jsb.fileUtils?jsb.fileUtils.getWritablePath():"/")+e,s=new jsb.AssetsManager("",r,function(e,t){return Number(e)-Number(t)});if(s.setVerifyCallback(function(e,t){var o=t.compressed,r=t.md5,s=t.path;return t.size,o?(n(i.Checking,"Verification passed : "+s,0),!0):(n(i.Checking,"Verification passed : "+s+" ("+r+")",0),!0)}),n(i.Checking,"Hot update is ready, please check or directly update",0),cc.sys.os===cc.sys.OS_ANDROID&&(s.setMaxConcurrentTask(2),n(i.Checking,"Max concurrent tasks count have been limited to 2",0)),n(i.Checking,"Checking or updating ...",0),s.getState()===jsb.AssetsManager.State.UNINITED)if(t){var c=t;cc.loader.md5Pipe&&(c=cc.loader.md5Pipe.transformURL(c)),s.loadLocalManifest(c)}else{var a=new jsb.Manifest(o,r);s.loadLocalManifest(a,r)}s.getLocalManifest()&&s.getLocalManifest().isLoaded()||n(i.Error,"Failed to load local manifest ...",0),s.setEventCallback(function(e){switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:s.setEventCallback(null),n(i.Error,"No local manifest file found, hot update skipped",0);break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:s.setEventCallback(null),n(i.Error,"Fail to download manifest file, hot update skipped",0);break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:s.setEventCallback(null),n(i.Done,"Already up to date with the latest remote version",0);break;case jsb.EventAssetsManager.NEW_VERSION_FOUND:n(i.Checking,"New version found, please try to update",0),s.setEventCallback(null),s&&(s.setEventCallback(function(e){switch(e.getEventCode()){case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:s.setEventCallback(null),n(i.Error,"No local manifest file found, hot update skipped",0);break;case jsb.EventAssetsManager.UPDATE_PROGRESSION:var t=e.getMessage();n(i.Updating,t,e.getPercentByFile());break;case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:s.setEventCallback(null),n(i.Error,"No local manifest file found, hot update skipped",0);break;case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:s.setEventCallback(null),n(i.Done,"Already up to date with the latest remote version",0);break;case jsb.EventAssetsManager.UPDATE_FINISHED:s.setEventCallback(null),n(i.UpdateDone,"Update finished. "+e.getMessage(),1);break;case jsb.EventAssetsManager.UPDATE_FAILED:s.setEventCallback(null),n(i.Error,"Update failed. "+e.getMessage(),0);break;case jsb.EventAssetsManager.ERROR_UPDATING:s.setEventCallback(null),n(i.Error,"Asset update error: "+e.getAssetId()+", "+e.getMessage(),0);break;case jsb.EventAssetsManager.ERROR_DECOMPRESS:s.setEventCallback(null),n(i.Error,e.getMessage(),0)}}),s.update());break;default:return}}),s.checkUpdate()},t.prototype.cancel=function(){cc.director.loadScene("home")},s([p(cc.Label)],t.prototype,"status",void 0),s([p(cc.ProgressBar)],t.prototype,"fileProgress",void 0),s([p({type:cc.Asset})],t.prototype,"manifest",void 0),o=s([u],t)}(cc.Component);o.default=d,cc._RF.pop()},{"../../../common/scripts/util":void 0,"../../../common/scripts/util-logger":void 0}],lessonButton:[function(e,t,o){"use strict";cc._RF.push(t,"65142Zn2nJMzL9T1AFOOeug","lessonButton");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lessonIcon"),c=e("../../../common/scripts/lib/config"),a=e("../../../common/scripts/lib/profile"),l=e("../../../common/scripts/util"),u=e("../../../common/scripts/lib/constants"),p=e("./preTestDialog"),d=cc._decorator,h=d.ccclass,f=d.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.preTestPopup=null,t.lockIcon=null,t.open=!1,t}return r(t,e),t.prototype.onLoad=function(){var e=this;if(c.default.i,null!=this.lesson&&null!=this.lesson.chapter.course&&null!=this.lesson){var t=cc.instantiate(this.lessonIconPrefab),o=t.getComponent(i.default);o.lesson=this.lesson,o.open=this.open,this.button.node.insertChild(t,0),this.label.string=this.lesson.type==u.EXAM?l.Util.i18NText("Challenge"):this.lesson.name,this.button.node.on("touchend",function(t){t.target.getComponent(cc.Button).interactable&&e.onClick()}),this.button.interactable=this.open||"reward"==this.lesson.chapter.course.id;var n=a.User.getCurrentUser().lessonProgressMap.get(this.lesson.id);null!==this.lesson.assignmentId&&void 0!==this.lesson.assignmentId?this.open&&n&&n.assignmentIds.includes(this.lesson.assignmentId)&&n.score>=0&&(this.star1.spriteFrame=n.score>25?this.goldStar:this.grayStar,this.star2.spriteFrame=n.score>50?this.goldStar:this.grayStar,this.star3.spriteFrame=n.score>75?this.goldStar:this.grayStar):this.open&&n&&n.score>=0&&(this.star1.spriteFrame=n.score>25?this.goldStar:this.grayStar,this.star2.spriteFrame=n.score>50?this.goldStar:this.grayStar,this.star3.spriteFrame=n.score>75?this.goldStar:this.grayStar),this.lockIcon.active=!this.open&&"reward"==this.lesson.chapter.course.id}},t.prototype.onClick=function(){if(!this.open&&"reward"==this.lesson.chapter.course.id)return a.User.getCurrentUser().currentReward=[l.REWARD_TYPES[4],this.lesson.chapter.id,this.lesson.id],c.default.i.popAllScenes(),void c.default.i.pushScene("menu/start/scenes/start","menu",null,!0);var e=a.User.getCurrentUser();if(c.COURSES_LANG_ID.includes(this.lesson.chapter.course.id))if(null!=e.courseProgressMap.get(this.lesson.chapter.course.id).currentChapterId||this.lesson.id.endsWith("_PreQuiz"))this.loadLesson();else{cc.log(this.lesson.chapter.course.id);try{var t=cc.instantiate(this.preTestPopup),o=cc.director.getScene().getChildByName("Canvas"),n=t.getComponent(p.default);n.isValid&&(n.courseId=this.lesson.chapter.course.id,n.chapter=this.lesson.chapter,o.addChild(t))}catch(r){}}else this.loadLesson()},t.prototype.loadLesson=function(){l.Util.loadLesson(this.lesson,this.loading,this.node)},s([f(cc.Label)],t.prototype,"label",void 0),s([f(cc.Button)],t.prototype,"button",void 0),s([f(cc.Prefab)],t.prototype,"lessonIconPrefab",void 0),s([f(cc.Sprite)],t.prototype,"downloadSprite",void 0),s([f(cc.Sprite)],t.prototype,"star1",void 0),s([f(cc.Sprite)],t.prototype,"star2",void 0),s([f(cc.Sprite)],t.prototype,"star3",void 0),s([f(cc.SpriteFrame)],t.prototype,"grayStar",void 0),s([f(cc.SpriteFrame)],t.prototype,"goldStar",void 0),s([f(cc.Prefab)],t.prototype,"preTestPopup",void 0),s([f(cc.Node)],t.prototype,"lockIcon",void 0),s([h],t)}(cc.Component);o.default=g,cc._RF.pop()},{"../../../common/scripts/lessonIcon":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/constants":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0,"./preTestDialog":"preTestDialog"}],picDisplayPrefab:[function(e,t,o){"use strict";cc._RF.push(t,"36cb0+0OLxFoJh8vQWRMvMy","picDisplayPrefab");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/profile"),c=e("../../../common/scripts/services/ParseImageDownloader"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.picNode=null,t.usernameNode=null,t}return r(t,e),t.prototype.onLoad=function(){this.loadUserImageOrAvatar()},t.prototype.loadUserImageOrAvatar=function(){var e=this,t=i.User.getCurrentUser(),o=this.picNode;t&&t.studentId&&""!=t.studentId&&t.studentId.length>0&&null==t.avatarImage?c.ParseImageDownloader.loadImageForSchool(t.imgPath,t.studentId,function(e){if(e&&o){var t=new cc.SpriteFrame(e),n=o.getChildByName("mask");n&&(n.getChildByName("image").getComponent(cc.Sprite).spriteFrame=t)}}):t&&t.avatarImage&&t.avatarImage.length>0&&cc.resources.load("avatars/"+t.avatarImage,function(t,o){e.picNode.getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(o)}),t.name.length>10?this.usernameNode.getComponent(cc.Label).string=t.name.substring(0,10)+"...":this.usernameNode.getComponent(cc.Label).string=t.name},s([u(cc.Node)],t.prototype,"picNode",void 0),s([u(cc.Node)],t.prototype,"usernameNode",void 0),s([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/services/ParseImageDownloader":void 0}],preTestDialog:[function(e,t,o){"use strict";cc._RF.push(t,"23815bQc+BO3pYCxF/Onkum","preTestDialog");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lessonController"),c=e("../../../common/scripts/lib/config"),a=e("../../../common/scripts/loading"),l=e("../../../common/scripts/util"),u=e("./chapterLessons"),p=e("./start"),d=cc._decorator,h=d.ccclass,f=d.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.loading=null,t}return r(t,e),t.prototype.onClickYes=function(){var e,t=this,o=c.default.i,n=o.curriculum.get(this.courseId);e=[p.default.preQuizLesson(n)],o.lesson=e[0],o.chapter=e[0].chapter,o.course=e[0].chapter.course,this.node.getChildByName("dialog_box").active=!1,this.node.getChildByName("block").active=!1,this.loading.getComponent(a.default).allowCancel=!0,this.loading.active=!0,i.default.preloadLesson(this.node.parent,function(e){u.default.showType==u.ChapterLessonType.Assignments||c.default.isMicroLink||(o.chapter=t.chapter),e?t.loading.getComponent(a.default).addMessage(l.Util.i18NText("Error downloading content. Please connect to internet and try again"),!0,!0):t.loading&&t.loading.activeInHierarchy&&o.pushScene("common/scenes/lessonController")})},t.prototype.onClickNo=function(){c.default.isMicroLink&&(c.default.isMicroLink=!1),this.node.removeFromParent(!0)},s([f(cc.Node)],t.prototype,"loading",void 0),s([h],t)}(cc.Component);o.default=g,cc._RF.pop()},{"../../../common/scripts/lessonController":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/loading":void 0,"../../../common/scripts/util":void 0,"./chapterLessons":"chapterLessons","./start":"start"}],reConnectPopup:[function(e,t,o){"use strict";cc._RF.push(t,"c9b1fwFbctA9ZJDElp21veA","reConnectPopup");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=cc._decorator,a=c.ccclass,l=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text=null,t.yesButton=null,t.block=null,t.dialog=null,t.msg=null,t}return r(t,e),t.prototype.onLoad=function(){},t.prototype.onEnable=function(){this.dialog.active=!0,this.block.active=!0},t.prototype.onDisable=function(){this.dialog.active=!1,this.block.active=!1},t.prototype.onClickYes=function(){i.default.i.pushScene("menu/Profile/scene/leaderboardProfile","menu")},t.prototype.onClickNo=function(){this.dialog.active=!1,this.block.active=!1,this.node.active=!1},s([l(cc.Node)],t.prototype,"text",void 0),s([l(cc.Node)],t.prototype,"yesButton",void 0),s([l(cc.Node)],t.prototype,"block",void 0),s([l(cc.Node)],t.prototype,"dialog",void 0),s([l(cc.Node)],t.prototype,"msg",void 0),s([a],t)}(cc.Component);o.default=u,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0}],startContent:[function(e,t,o){"use strict";cc._RF.push(t,"8dd3dM68/dIZr6N+Ydk2DUq","startContent");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(t){s(t)}}function c(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,c)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(e){return function(t){return a([e,t])}}function a(s){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},a=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],i=0,c=s.length;i<c;i++,r++)n[r]=s[i];return n};Object.defineProperty(o,"__esModule",{value:!0});var l=e("../../../common/scripts/lib/config"),u=e("../../../common/scripts/lib/profile"),p=e("./lessonButton"),d=e("../../../common/scripts/util"),h=e("../../../common/scripts/lib/constants"),f=e("../../../common/scripts/services/ServiceConfig"),g=cc._decorator,m=g.ccclass,y=g.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.startLessonButtonPrefab=null,t.pageView=null,t}var o;return r(t,e),o=t,t.prototype.onLoad=function(){return i(this,void 0,void 0,function(){var e,t,n=this;return c(this,function(r){switch(r.label){case 0:return e=u.User.getCurrentUser(),t=[],e.courseProgressMap.forEach(function(e,r){var s=l.default.i.curriculum.get(r);e.currentChapterId?s.chapters.forEach(function(o,r){if(o.id==e.currentChapterId){t.push(n.createButton(n.recommendedLessonInChapter(o)));var i=d.Util.shuffleByMapSortMap(s.chapters.slice(Math.max(0,r-3),r));i.length>0?t.push(n.createButton(n.recommendedLessonInChapter(i[0]))):r+1<s.chapters.length&&t.push(n.createButton(n.recommendedLessonInChapter(s.chapters[r+1])))}}):t.push(o.createPreQuizButton(s,n.startLessonButtonPrefab,n.loading))}),d.Util.shuffle(t),t.forEach(function(e,t,o){e.x=-cc.winSize.width/2+cc.winSize.width/o.length*t,e.y=-cc.winSize.height/2+256+(cc.winSize.height-256)/o.length*t,n.node.addChild(e)}),[4,f.ServiceConfig.getI().handle.listAssignments(e.id)];case 1:return r.sent().forEach(function(e){var t=l.default.i.curriculum.get(e.courseCode);if(t){var o=t.chapters.find(function(t){return t.id==e.chapterId}),r=null;o&&(r=o.lessons.find(function(t){return t.id==e.lessonId}))&&n.node.children[0].getComponent(cc.PageView).insertPage(n.createButton(r),0)}}),[2]}})})},t.prototype.recommendedLessonInChapter=function(e){var t=u.User.getCurrentUser(),o=e.lessons.findIndex(function(e,o){return!(0==o||e.open||t.lessonProgressMap.has(e.id))}),n=e.lessons[-1==o?0:o-1];if(n.type==h.EXAM&&t.lessonProgressMap.has(n.id)&&t.lessonProgressMap.get(n.id).score<h.MIN_PASS){var r=!1,s=!1,i=a(e.lessons).reverse().filter(function(e){return r?s?void 0:e.type!=h.EXAM||(s=!0,!1):(e.id==n.id&&(r=!0),!1)}).sort(function(e,o){var n=t.lessonProgressMap.get(e.id),r=t.lessonProgressMap.get(o.id);return(n?n.attempts:0)-(r?r.attempts:0)});if(0==i.length)return n;if(1==i.length){var c=t.lessonProgressMap.get(i[0].id),l=t.lessonProgressMap.get(n.id);return(c?c.date:new Date)<(l?l.date:new Date)?i[0]:n}c=t.lessonProgressMap.get(i[0].id);var p=t.lessonProgressMap.get(i[1].id),d=c?c.attempts:0,f=p?p.attempts:0,g=(l=t.lessonProgressMap.get(n.id))?l.attempts:0;return d<f||d<=g?i[0]:n}return n},t.prototype.createButton=function(e){return o.createLessonButton(e,this.startLessonButtonPrefab,this.loading)},t.createPreQuizButton=function(e,t,n){var r={id:e.id+"PreQuiz",image:"",name:d.Util.i18NText("Begin Quiz"),open:!0,chapter:{id:e.id+"PreQuizChapter",lessons:[],name:e.name,image:"",course:e}};return o.createLessonButton(r,t,n)},t.createLessonButton=function(e,t,o){var n=cc.instantiate(t),r=n.getComponent(p.default);return r.lesson=e,r.loading=o,r.open=!0,n},s([y(cc.Prefab)],t.prototype,"startLessonButtonPrefab",void 0),s([y(cc.PageView)],t.prototype,"pageView",void 0),o=s([m],t)}(cc.Component);o.default=v,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/constants":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/services/ServiceConfig":void 0,"../../../common/scripts/util":void 0,"./lessonButton":"lessonButton"}],startHeaderButton:[function(e,t,o){"use strict";cc._RF.push(t,"4cda04eVtFEeIHrF6+f3P9Y","startHeaderButton");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("./chapterLessons"),a=cc._decorator,l=a.ccclass,u=a.property,p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.onMoreClick=function(){i.default.i.course.id==i.ASSIGNMENT_COURSE_ID?(c.default.showType=c.ChapterLessonType.Assignments,i.default.i.pushScene("menu/start/scenes/chapterLessons","menu")):i.default.i.pushScene("menu/start/scenes/courseChapters","menu")},s([u(cc.Label)],t.prototype,"label",void 0),s([u(cc.Button)],t.prototype,"button",void 0),s([u(cc.Sprite)],t.prototype,"sprite",void 0),s([u(cc.Sprite)],t.prototype,"selected",void 0),s([u(cc.Button)],t.prototype,"moreButton",void 0),s([l],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"./chapterLessons":"chapterLessons"}],startHeader:[function(e,t,o){"use strict";cc._RF.push(t,"eb13593dUxFAI8dV1RHgoMT","startHeader");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i};Object.defineProperty(o,"__esModule",{value:!0});var i=e("../../../common/scripts/lib/config"),c=e("../../../common/scripts/lib/constants"),a=e("../../../common/scripts/lib/profile"),l=e("../../../common/scripts/util"),u=e("./startHeaderButton"),p=cc._decorator,d=p.ccclass,h=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.courseLayout=null,t.headerButtonPrefab=null,t.rightPos=null,t.assignmentSprite=null,t.firstSelected=!0,t}var o;return r(t,e),o=t,t.prototype.onLoad=function(){var e=this,t=i.default.i,o=this.user.courseProgressMap,n=Array.from(o.keys()),r=parseInt(a.default.getValue(a.CURRENTMODE));try{n.sort(function(e,t){return c.courseSortIndex[e]-c.courseSortIndex[t]})}catch(l){cc.log(l)}n.forEach(function(o){(o!=i.ASSIGNMENT_COURSE_ID||a.User.getCurrentUser().isConnected)&&(o==i.ASSIGNMENT_COURSE_ID&&r===c.Mode.School||e.addButton(o,o==t.course.id))}),this.node.width=cc.winSize.width;var s=Math.max(0,(this.courseLayout.width-this.courseLayout.childrenCount*this.courseLayout.children[0].width)/(this.courseLayout.childrenCount+1));this.courseLayout.getComponent(cc.Layout).spacingX=s,this.courseLayout.getComponent(cc.Layout).paddingLeft=s,this.courseLayout.getComponent(cc.Layout).paddingRight=s},t.prototype.addButton=function(e,t){var n=this,r=i.default.i,s=cc.instantiate(this.headerButtonPrefab),c=s.getComponent(u.default);c.selected.node.active=!1,this.courseLayout.addChild(s),t&&this.selectHeaderButton(c),l.Util.load(e+"/course/res/icons/"+e+".png",function(e,t){c.sprite&&(c.sprite.spriteFrame=e?null:new cc.SpriteFrame(t))});var p=r.curriculum.get(e);c.label.string=l.Util.i18NText(p.name),c.button.node.on("touchend",function(t){t.target.getComponent(cc.Button).enabled&&(o.homeSelected=!1,n.selectHeaderButton(c),r.course=p,r.startCourse=p,n.onCourseClick&&n.onCourseClick(e))});var d=a.User.getCurrentUser().courseProgressMap.get(i.ASSIGNMENT_COURSE_ID);e==i.ASSIGNMENT_COURSE_ID&&d.lessonPlan.length>0&&(s.getChildByName("tick").active=!0)},t.prototype.selectHeaderButton=function(e){null!=this.selectedHeaderButton&&(this.selectedHeaderButton.selected.node.active=!1,this.selectedHeaderButton.button.enabled=!0,this.selectedHeaderButton.moreButton.node.active=!1),e.selected.node.active=!0,e.button.enabled=!1,e.moreButton.node.active=!0,this.selectedHeaderButton=e},t.homeSelected=!0,s([h(cc.Node)],t.prototype,"courseLayout",void 0),s([h(cc.Prefab)],t.prototype,"headerButtonPrefab",void 0),s([h(cc.Node)],t.prototype,"rightPos",void 0),s([h(cc.SpriteFrame)],t.prototype,"assignmentSprite",void 0),o=s([d],t)}(cc.Component);o.default=f,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/constants":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/util":void 0,"./startHeaderButton":"startHeaderButton"}],start:[function(e,t,o){"use strict";cc._RF.push(t,"334f2WfhThDUp2BXojJ6HNk","start");var n,r=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__decorate||function(e,t,o,n){var r,s=arguments.length,i=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,n);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(s<3?r(i):s>3?r(t,o,i):r(t,o))||i);return s>3&&i&&Object.defineProperty(t,o,i),i},i=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,s){function i(e){try{a(n.next(e))}catch(t){s(t)}}function c(e){try{a(n.throw(e))}catch(t){s(t)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(i,c)}a((n=n.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var o,n,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function c(e){return function(t){return a([e,t])}}function a(s){if(o)throw new TypeError("Generator is already executing.");for(;i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(c){s=[6,c],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var a=e("../../../chimple"),l=e("../../../common/scripts/friend"),u=e("../../../common/scripts/lib/config"),p=e("../../../common/scripts/lib/constants"),d=e("../../../common/scripts/lib/profile"),h=e("../../../common/scripts/loading"),f=e("../../../common/scripts/services/ServiceConfig"),g=e("../../../common/scripts/teacherAddedDialog"),m=e("../../../common/scripts/util"),y=e("../../inventory/scripts/inventory"),v=e("./lessonButton"),b=e("./chapterLessons"),_=e("../../../common/scripts/util-logger"),C=e("./assignmentPopup"),P=e("../../../common/scripts/chimple-label"),w=e("./startHeader"),S=e("./reConnectPopup"),B=e("../../rewards/scripts/rewards"),R=e("../../../common/scripts/lib/error-handler"),E=["congratulations","excellent","try_again","very_good","you_are_getting_better","i_enjoyed_eating"],O=["i_am_hungry","let_us_start_our_learning_journey","may_i_help_you","my_name_is_chimple"],N=cc._decorator,L=N.ccclass,A=N.property,M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.profilePrefab=null,t.loading=null,t.teacherDialogPrefab=null,t.bgHolder=null,t.bgMusic=null,t.homeButton=null,t.lessonButtonPrefab=null,t.content=null,t.currentLesson=null,t.giftBoxPrefab=null,t.currentLessonButton=null,t.ctx=null,t.library=null,t.assignmentButton=null,t.featuredButton=null,t.assignmentCount=null,t.preTestPopup=null,t.headerPrefab=null,t.header=null,t.rewardBg=null,t.timer=0,t.flag=!0,t.assignPopupActive=!0,t.disableGiftBoxNodeFlag=!1,t}var o;return r(t,e),o=t,t.prototype.start=function(){return i(this,void 0,void 0,function(){var e,t,o,n,r;return c(this,function(s){switch(s.label){case 0:if(e=u.default.i,t=parseInt(d.default.getValue(d.CURRENTMODE)),o=d.User.getCurrentUser(),t==p.Mode.School)return[3,3];if(this.loading.active=!0,!this.isAssignmentsExistsInLessonPlan()&&o.isConnected)return[3,1];if(e.assignments)try{this.checkPendingAssignments()}catch(i){}else this.getAssigments();return[3,3];case 1:return[4,this.getAssigments()];case 2:s.sent(),s.label=3;case 3:return e.course?(e.unsetRewardChapter(),e.course=e.startCourse):(e.course=this.getNextCourse(),e.startCourse=e.course),this.createAndDisplayLessonPlan(),this.displayCurrentReward(),n=cc.instantiate(this.headerPrefab),(r=n.getComponent(w.default)).user=o,r.onCourseClick=this.onCourseClick.bind(this),this.header.addChild(n),this.loading.active=!1,t==p.Mode.HomeConnect&&!o.isConnected&&o.schoolId?this.showReConnectPopup("You are disconnected or class code is expired"):t==p.Mode.Home&&o.isConnected&&this.showReConnectPopup("Re-Connect to your class using Student ID"),[2]}})})},t.prototype.onLoad=function(){return i(this,void 0,void 0,function(){var e,t,o,n=this;return c(this,function(){return e=d.User.getCurrentUser(),this.bgHolder.removeAllChildren(),cc.audioEngine.pauseMusic(),e&&e.currentBg?m.Util.setBackground(e.currentBg,this.bgHolder):m.Util.setBackground("camp",this.bgHolder),this.loading.getComponent(h.default).allowCancel=!1,t=u.default.i,o=t.startAction,this.gift=cc.instantiate(this.giftBoxPrefab),e.curriculumLoaded?this.initPage():t.loadCourseJsons(e,this.node,this.initPage.bind(this)),m.Util.loadFriend(function(e){var t;n.friend=e,e.scale=.8,null===(t=n.node)||void 0===t||t.addChild(n.friend),e.y=-cc.winSize.height/2+16,e.x=cc.winSize.width/3.25,m.Util.loadAccessoriesAndEquipAcc(e.children[1],e);var r=n.friend.getComponent(l.default);switch(o){case u.StartAction.Start:r.helpFile="start";break;case u.StartAction.MoveLessonPlan:case u.StartAction.LessonComplete:r.helpFile=E[Math.floor(Math.random()*E.length)];break;case u.StartAction.Default:r.helpFile=O[Math.floor(Math.random()*O.length)]}r.speakHelp(!0)}),b.default.showType=b.ChapterLessonType.Library,_.default.syncFmcTokenForUsers(),[2]})})},t.prototype.showReConnectPopup=function(e,t){void 0===t&&(t="Do you want to connect now?");var o=this.node.getChildByName("reconnect_popup");0==o.active&&(o.getComponent(S.default).msg.getComponent(P.default).string=m.Util.i18NText(e),o.getComponent(S.default).text.getComponent(P.default).string=m.Util.i18NText(t),o.active=!0,o.zIndex=2)},t.prototype.initPage=function(){var e=d.User.getCurrentUser();u.default.i,null!=e.currentReward&&0!=e.currentReward.length||(e.currentReward=this.getNextReward()),u.default.isMicroLink||(this.loading.active=!1),this.registerTeacherDialogCloseEvent()},t.prototype.createAndDisplayLessonPlan=function(){var e=d.User.getCurrentUser(),t=u.default.i,o=e.courseProgressMap.get(t.course.id);o.lessonPlan&&o.lessonPlan.length>0&&o.lessonPlanIndex<=o.lessonPlan.length?this.displayLessonPlan():(this.createLessonPlan(t.course.id),this.displayLessonPlan())},t.prototype.getNextCourse=function(){var e=d.User.getCurrentUser().courseProgressMap,t=Array.from(e.keys());try{t.sort(function(t,o){return e.get(t).date.getTime()-e.get(o).date.getTime()})}catch(n){cc.log(n)}var o=parseInt(d.default.getValue(d.CURRENTMODE));return d.User.getCurrentUser().isConnected&&o!=p.Mode.School?this.isAssignmentsExistsInLessonPlan()||u.default.i.getAssignmentLessonsTodo()&&u.default.i.getAssignmentLessonsTodo().length>0?u.default.i.curriculum.get(u.ASSIGNMENT_COURSE_ID):u.default.i.curriculum.get(t[0]===u.ASSIGNMENT_COURSE_ID?t[1]:t[0]):u.default.i.curriculum.get(t[1]===u.ASSIGNMENT_COURSE_ID?t[0]:t[1])},t.prototype.registerTeacherDialogCloseEvent=function(){var e=this;this.node.on(g.TEACHER_ADD_DIALOG_CLOSED,function(t){return i(e,void 0,void 0,function(){var e=this;return c(this,function(){return t.stopPropagation(),this.scheduleOnce(function(){e.showTeacherDialog()},1),[2]})})})},t.prototype.loadLesson=function(e){if(u.default.isMicroLink&&e&&e.length>0){var t=d.User.getCurrentUser(),o=e.splice(e.length-1,e.length)[0];cc.sys.isNative&&u.COURSES_LANG_ID.includes(o.courseid)?(t.courseProgressMap.get(o.courseid),this.openDirectLesson(o)):this.openDirectLesson(o)}},t.prototype.openDirectLesson=function(e){this.loading.active=!0;var t={courseid:e.courseid,chapterid:e.chapterid,lessonid:e.lessonid,assignmentid:e.assignmentid||null};m.Util.loadDirectLessonWithLink(t,this.node)},t.prototype.showTeacherDialog=function(){try{var e=cc.sys.localStorage.getItem(a.RECEIVED_TEACHER_REQUEST)||"[]",t=JSON.parse(e);if(cc.log("showTeacherDialog",e),t&&t.length>0){var o=t.splice(0,1)[0],n=o[a.TEACHER_NAME_KEY],r=o[a.TEACHER_ID_KEY],s=o[a.TEACHER_SECTION_ID],i=o[a.TEACHER_ADD_STUDENT_ID];cc.sys.localStorage.setItem(a.RECEIVED_TEACHER_REQUEST,JSON.stringify(t));var c=a.ACCEPT_TEACHER_REQUEST_LINKED_USED+r,l=JSON.parse(cc.sys.localStorage.getItem(c)||"[]"),u=r+"|"+s+"|"+i,p=l.includes(u);if(cc.log("checking if received teacher request link "+u+"  is used "+p),r&&n&&s&&i&&!p){var d=cc.instantiate(this.teacherDialogPrefab),h=d.getComponent(g.default);h.TeacherName=n,h.TeacherId=r,h.SelectedSectionId=s,h.SelectedAddStudentId=i,h.validate().length>0&&this.node.addChild(d)}}}catch(f){}},t.prototype.setUpTeacherDialog=function(){this.showTeacherDialog()},t.prototype.onProfileClick=function(e){var t=e.target.getComponent(cc.Button);t&&(t.interactable=!1),u.default.i.pushScene("menu/rewards/scenes/rewards","menu")},t.prototype.onDairyRewardClick=function(e){var t=e.target.getComponent(cc.Button);t&&(t.interactable=!1),u.default.i.pushScene("menu/rewards/scenes/dairyrewards","menu")},t.prototype.onAssignmentsClick=function(){u.default.i.pushScene("menu/Profile/scene/leaderboardProfile","menu")},t.prototype.onFeaturedClick=function(){b.default.showType=b.ChapterLessonType.Featured,u.default.i.pushScene("menu/start/scenes/chapterLessons","menu")},t.prototype.onLibraryClick=function(){this.node.getChildByName("library_button").getComponent(cc.Button).interactable=!1,u.default.i.pushScene("menu/start/scenes/courseChapters","menu")},t.prototype.onCourseClick=function(){this.ctx.clear(!0),this.createAndDisplayLessonPlan()},t.prototype.createLessonPlan=function(e){var t=d.User.getCurrentUser(),n=t.courseProgressMap.get(e),r=u.default.i.curriculum.get(e);if(e==u.ASSIGNMENT_COURSE_ID){var s=u.default.i.getAssignmentLessonsTodo();null!=s&&s.length>0&&(n.lessonPlan=s.slice(0,Math.min(5,s.length)).map(function(e){return e.id}),n.lessonPlanIndex=0,n.lessonPlanDate=new Date,t.storeUser())}else{var i,c=r.chapters.find(function(e){return e.id==n.currentChapterId});!c||n.currentLessonId&&c.lessons.find(function(e){return e.id==n.currentLessonId})||(n.currentLessonId=c.lessons[0].id),"puzzle"==r.id?(i=[],r.chapters.forEach(function(e){var o;if(!(o=e.lessons.find(function(e){return!t.lessonProgressMap.has(e.id)}))){var n=Math.floor(Math.random()*(e.lessons.length-1-0+1)+0);o=e.lessons[n]}o&&i.push(o)})):n.currentChapterId?(i=this.getLessonsForPlan(c,n.currentLessonId))&&0!=i.length||(n.currentLessonId=c.lessons[0].id,i=this.getLessonsForPlan(c,n.currentLessonId)):i=[o.preQuizLesson(r)],n.lessonPlan=i.map(function(e){return e.id}),n.lessonPlanIndex=0,n.lessonPlanDate=new Date,t.storeUser()}},t.prototype.getLessonsForPlan=function(e,t){var o=!1,n=!1;return e.lessons.filter(function(e){return o||e.id!=t||(o=!0),!(!o||n||(n||e.type!=p.EXAM||(n=!0),0))})},t.prototype.checkPendingAssignments=function(){for(var e=0,t=0,o=u.default.i.assignments;t<o.length;t++){var n=o[t],r=u.default.i.allLessons.get(n.lessonId);if(r){var s=d.User.getCurrentUser().lessonProgressMap.get(n.lessonId);s?s&&![].concat(s.assignmentIds).includes(n.assignmentId)&&(r.assignmentId=n.assignmentId,e++):e++}}this.assignmentCount.getChildByName("count").getComponent(cc.Label).string=e.toString()},t.prototype.displayLessonPlan=function(){var e=this,t=d.User.getCurrentUser(),n=t.courseProgressMap.get(u.default.i.course.id);if(this.content.removeAllChildren(),null!=n.lessonPlan&&n.lessonPlan.length>0){this.node.getChildByName("rewardBg").active=!0,this.node.getChildByName("giftBox").active=!0;var r=cc.winSize.width-128,s=-r/2,i=r/4,c=-r/4,a=r/2;this.ctx.moveTo(s,-172),this.ctx.bezierCurveTo(i,-172,c,172,a,172),this.ctx.stroke(),n.lessonPlan.forEach(function(t,r,l){var p=o.createLessonButton(t.endsWith("_PreQuiz")?o.preQuizLesson(u.default.i.curriculum.get(t.split("_")[0])):u.default.i.allLessons.get(t),e.lessonButtonPrefab,e.loading,r<=n.lessonPlanIndex),d=r/l.length;if(p.x=Math.pow(1-d,3)*s+3*Math.pow(1-d,2)*d*i+3*(1-d)*Math.pow(d,2)*c+Math.pow(d,3)*a,p.y=-172*Math.pow(1-d,3)+3*Math.pow(1-d,2)*d*-172+3*(1-d)*Math.pow(d,2)*172+172*Math.pow(d,3),p.scale=.75,e.content.addChild(p),r==n.lessonPlanIndex){var h=cc.instantiate(e.currentLessonButton),f=h.getComponent(cc.Animation);f.play("level_play_button").repeatCount=20,h.y=80,h.scale=1;var g=p.getComponent(v.default);if(g){var m=h.getChildByName("play button").addComponent(cc.Button);m.transition=cc.Button.Transition.SCALE,m.node.on("touchend",function(){g.button.interactable&&(f.stop("level_play_button"),e.node.getChildByName("beginQuizPopup").active=!1,g.onClick())})}if(p.addChild(h),u.default.i.startAction==u.StartAction.MoveLessonPlan&&r>0){var y=e.content.children[r-1],b=h.position.clone();h.position=p.convertToNodeSpaceAR(y.convertToWorldSpaceAR(cc.v3(0,300,0))),h.runAction(cc.bezierTo(1,[cc.v2(h.position.x,b.y+200),cc.v2(b.x,b.y+100),cc.v2(b)]))}}}),this.gift=cc.instantiate(this.giftBoxPrefab),this.gift.x=Math.pow(0,3)*s+3*Math.pow(0,2)*i+0*Math.pow(1,2)*c+Math.pow(1,3)*a,this.gift.y=-172*Math.pow(0,3)+3*Math.pow(0,2)*-172+0*Math.pow(1,2)+172*Math.pow(1,3),null==this.node.getChildByName("giftBox").getChildByName(this.gift.name)&&this.node.getChildByName("giftBox").addChild(this.gift),n.lessonPlanIndex==n.lessonPlan.length&&this.giveReward(t),u.default.i.startAction=u.StartAction.Default}else{this.node.getChildByName("rewardBg").active=!1,this.disableGiftBoxNodeFlag&&(this.node.getChildByName("giftBox").active=!1);var l=new cc.Node;l.addComponent(P.default).string="No lessons found. Try another subject",this.content.addChild(l)}},t.prototype.onBeginQuizCancelClick=function(){this.node.getChildByName("beginQuizPopup").active=!1},t.prototype.onBeginQuizButtonClicked=function(){this.beginQuiz.getComponent(v.default).onClick(),this.loading.active=!0},t.prototype.giveReward=function(){var e=this;console.log("giveReward node",this.node.getChildByName("giftBox").children[0]);var t=this.node.getChildByName("giftBox").children[0];console.log("giveReward node",t);var o=cc.repeat(cc.sequence(cc.scaleTo(.3,1.2,1.2),cc.scaleTo(.3,1,1)),100);t.runAction(o),this.node.getChildByName("beginQuizPopup").active=!1,this.node.getChildByName("block").active=!0,(new cc.Tween).target(t).to(.5,{position:cc.Vec3.ZERO},null).start(),this.node.getChildByName("giftBox").once("touchend",function(){(new cc.Tween).target(t).call(function(){t.getComponent(cc.Animation).play()}).delay(2).call(function(){e.unlockCurrentReward()}).start()})},t.createPreQuizButton=function(e,t,n,r){var s={id:e.id+"_PreQuiz",image:"",name:e.name,open:r,chapter:{id:e.id+"_PreQuizChapter",lessons:[],name:e.name,image:"",course:e}};return o.createLessonButton(s,t,n,r)},t.preQuizLesson=function(e){return{id:e.id+"_PreQuiz",image:"",name:e.name,open:!0,chapter:{id:e.id+"_PreQuizChapter",lessons:[],name:e.name,image:"",course:e}}},t.createLessonButton=function(e,t,o,n){var r=cc.instantiate(t),s=r.getComponent(v.default);return s.lesson=e,s.loading=o,s.open=n,r},t.prototype.onDisable=function(){var e,t=null===(e=this.friend)||void 0===e?void 0:e.getComponent(l.default);null==t||t.stopAudio()},t.prototype.onDestroy=function(){cc.audioEngine.stopMusic()},t.prototype.showAssignmentPopup=function(e){return i(this,void 0,void 0,function(){var t,o,n,r;return c(this,function(s){switch(s.label){case 0:return!this.flag||u.default.isMicroLink?[3,2]:(this.flag=!1,t=d.User.getCurrentUser(),o=this,[4,f.ServiceConfig.getI().handle.listAssignments(t.id)]);case 1:if(o.assignments=s.sent(),this.assignments=this.assignments.reverse(),this.assignments.length>0&&!e&&(n=m.Util.getHash(this.assignments[0].assignmentId),u.default.i.assignments=this.assignments,this.previousHash!=n&&(this.previousHash=n,0==(r=this.node.getChildByName("assignment_popup")).active&&(r.getComponent(C.default).msg.getComponent(P.default).string="New assignment has been assigned to you",r.active=!0))),e)try{0==(r=this.node.getChildByName("assignment_popup")).active&&(r.getComponent(C.default).msg.getComponent(P.default).string="You have pending assignments",r.active=!0)}catch(i){}this.flag=!0,s.label=2;case 2:return[2]}})})},t.prototype.getNextReward=function(){for(var e,t,o=function(e){return!!d.User.getCurrentUser().unlockedRewards[e]},n=0,r=u.default.i.curriculum.get("reward").chapters;n<r.length;n++)for(var s=r[n],i=0,c=s.lessons;i<c.length;i++){var a=c[i];if(!d.User.getCurrentUser().unlockedRewards[m.REWARD_TYPES[4]+"-"+s.id+"-"+a.id])return[m.REWARD_TYPES[4],s.id,a.id];if(null==a?void 0:a.skills)for(var l=0,p=a.skills;l<p.length;l++){var h=p[l];if(!d.User.getCurrentUser().unlockedRewards[m.REWARD_TYPES[4]+"-"+s.id+"-"+a.id+"-"+h])return[m.REWARD_TYPES[4],s.id,a.id,h]}}for(var f=0,g=m.REWARD_CHARACTERS;f<g.length;f++){var y=g[f];if(!o(m.REWARD_TYPES[0]+"-"+y))return[m.REWARD_TYPES[0],y];for(var v=0,b=m.INVENTORY_DATA;v<b.length;v++)for(var _=0,C=b[v];_<C.length;_++){var P=C[_];if(!o(m.REWARD_TYPES[3]+"-"+y+"-"+P))return[m.REWARD_TYPES[3],y,null!==(e=P.split("-")[0])&&void 0!==e?e:"",null!==(t=P.split("-")[1])&&void 0!==t?t:""]}}for(var w=0,S=m.REWARD_BACKGROUNDS;w<S.length;w++){var B=S[w];if(!o(m.REWARD_TYPES[1]+"-"+B))return[m.REWARD_TYPES[1],B]}return[]},t.prototype.displayCurrentReward=function(){var e=this;if(this.gift){var t=d.User.getCurrentUser().currentReward;switch(t[0]){case m.REWARD_TYPES[0]:cc.resources.load("char_icons/"+t[1]+"_icon",function(t,o){var n=new cc.Node,r=n.addComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(o),m.Util.resizeSprite(r,64,64),e.toAddGiftBoxNode(n,o)});break;case m.REWARD_TYPES[1]:cc.resources.load("backgrounds/textures/bg_icons/background-"+t[1],function(t,o){var n=new cc.Node,r=n.addComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(o),m.Util.resizeSprite(r,64,64),e.toAddGiftBoxNode(n,o)});break;case m.REWARD_TYPES[2]:break;case m.REWARD_TYPES[3]:cc.resources.load(m.INVENTORY_ICONS[t[2]]+t[3],function(t,o){if(t)cc.log(JSON.stringify(t));else{var n=new cc.Node,r=n.addComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(o),m.Util.resizeSprite(r,64,64),e.toAddGiftBoxNode(n,o)}});break;case m.REWARD_TYPES[4]:if("sticker"==t[1])u.default.loadBundle(t[2],function(o){o.load("res/"+t[1]+"-"+t[2],cc.Texture2D,function(t,o){var n;if(t)cc.log(JSON.stringify(t));else{var r=new cc.Node;r.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(o),null===(n=e.rewardBg)||void 0===n||n.addChild(r)}}),o.load("res/"+t[3],cc.Texture2D,function(t,o){if(t)cc.log(JSON.stringify(t));else{var n=new cc.Node,r=n.addComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(o),m.Util.resizeSprite(r,64,64),e.toAddGiftBoxNode(n,o)}})},function(e){e&&cc.log(JSON.stringify(e))});else{var o=new cc.Node,n=o.addComponent(cc.Sprite);n.spriteFrame=new cc.SpriteFrame;var r=u.default.i.allLessons.get(t[2]);m.Util.load("reward/course/res/icons/"+r.image,function(t,r){t||(n.spriteFrame=new cc.SpriteFrame(r),m.Util.resizeSprite(n,64,64),e.toAddGiftBoxNode(o,r))})}}}},t.prototype.toAddGiftBoxNode=function(e,t){var o;null===(o=this.gift)||void 0===o||o.addChild(e);var n=(new cc.Node).addComponent(cc.Sprite);n.spriteFrame=new cc.SpriteFrame(t),new cc.SpriteFrame(t);var r=m.Util.minScale(n,64,64,1),s=r.scale,i=r.size;if(console.log("const size = sprite.getOriginalSize();",n.spriteFrame.getOriginalSize(),i,"scale",s),console.log("scale * size.width, scale * size.height",s*i.width,s*i.height),null==this.node.getChildByName("giftBox").getChildByName(this.gift.name)){this.node.getChildByName("giftBox").addChild(this.gift);var c=cc.winSize.width-128,a=-c/2,l=c/4,p=-c/4,h=c/2;this.gift.x=Math.pow(0,3)*a+3*Math.pow(0,2)*l+0*Math.pow(1,2)*p+Math.pow(1,3)*h,this.gift.y=-172*Math.pow(0,3)+3*Math.pow(0,2)*-172+0*Math.pow(1,2)+172*Math.pow(1,3),this.node.getChildByName("giftBox").children[0].getChildByName(e.name).width=s*i.width,this.node.getChildByName("giftBox").children[0].getChildByName(e.name).height=s*i.height}else null!=this.node.getChildByName("giftBox").children[0].getChildByName(e.name)&&(this.node.getChildByName("giftBox").children[0].getChildByName(e.name).getComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(t),this.node.getChildByName("giftBox").children[0].getChildByName(e.name).width=s*i.width,this.node.getChildByName("giftBox").children[0].getChildByName(e.name).height=s*i.height);console.log("addGiftBox called",u.default.i.course.id);var f=d.User.getCurrentUser(),g=f.courseProgressMap.get(u.default.i.course.id);!this.disableGiftBoxNodeFlag&&f.isConnected&&u.default.i.course.id==u.ASSIGNMENT_COURSE_ID&&(null==g.lessonPlan||g.lessonPlan.length<=0)?(console.log("if called"),this.node.getChildByName("giftBox").active=!1,this.disableGiftBoxNodeFlag=!0):d.User.getCurrentUser().isConnected&&u.default.i.course.id!=u.ASSIGNMENT_COURSE_ID&&(console.log("if called"),this.disableGiftBoxNodeFlag=!0)},t.prototype.unlockCurrentReward=function(){var e=d.User.getCurrentUser().currentReward,t=d.User.getCurrentUser().courseProgressMap.get(u.default.i.course.id);if(t.lessonPlan=[],t.lessonPlanIndex=0,null==e||e.length<1)cc.director.loadScene(cc.director.getScene().name);else switch(d.User.getCurrentUser().unlockRewardsForItem(e.join("-"),1),d.User.getCurrentUser().currentReward=null,e[0]){case m.REWARD_TYPES[0]:B.default.contentDecisionFlag="0",u.default.i.pushScene("menu/rewards/scenes/rewards","menu");break;case m.REWARD_TYPES[1]:B.default.contentDecisionFlag="1",u.default.i.pushScene("menu/rewards/scenes/rewards","menu");break;case m.REWARD_TYPES[2]:break;case m.REWARD_TYPES[3]:y.default.characterName=e[1],u.default.getInstance().pushScene("menu/inventory/scenes/inventory","menu");break;case m.REWARD_TYPES[4]:u.default.i.setRewardChapter(e[1]),m.Util.loadLesson(u.default.i.allLessons.get(e[2]),this.loading,this.node)}},t.prototype.isAssignmentsExistsInLessonPlan=function(){var e=d.User.getCurrentUser().courseProgressMap.get(u.ASSIGNMENT_COURSE_ID);return e.lessonPlan&&e.lessonPlan.length>0&&e.lessonPlanIndex<=e.lessonPlan.length},t.prototype.getAssigments=function(){return i(this,void 0,void 0,function(){var e,t,o,n;return c(this,function(r){switch(r.label){case 0:return e=u.default.i,t=parseInt(d.default.getValue(d.CURRENTMODE)),o=d.User.getCurrentUser(),n=this,[4,f.ServiceConfig.getI().handle.listAssignments(o.id)];case 1:if(n.assignments=r.sent(),e.assignments=this.assignments,(e.assignments.length>0||!o.isConnected)&&(e.assignments.length>0&&!o.isConnected&&t!=p.Mode.HomeConnect&&(o.isConnected=!0,o.storeUser()),this.assignmentButton&&(this.assignmentButton.interactable=!0)),o.isConnected&&e.assignments.length>0){this.previousHash=m.Util.getHash(this.assignments[0].assignmentId);try{this.assignmentCount.active=!0,this.checkPendingAssignments()}catch(s){}}return[2]}})})},s([A(cc.Prefab)],t.prototype,"profilePrefab",void 0),s([A(cc.Node)],t.prototype,"loading",void 0),s([A(cc.Prefab)],t.prototype,"teacherDialogPrefab",void 0),s([A(cc.Node)],t.prototype,"bgHolder",void 0),s([A(cc.AudioClip)],t.prototype,"bgMusic",void 0),s([A(cc.Node)],t.prototype,"homeButton",void 0),s([A(cc.Prefab)],t.prototype,"lessonButtonPrefab",void 0),s([A(cc.Node)],t.prototype,"content",void 0),s([A(cc.SpriteFrame)],t.prototype,"currentLesson",void 0),s([A(cc.Prefab)],t.prototype,"giftBoxPrefab",void 0),s([A(cc.Prefab)],t.prototype,"currentLessonButton",void 0),s([A(cc.Graphics)],t.prototype,"ctx",void 0),s([A(cc.Label)],t.prototype,"library",void 0),s([A(cc.Sprite)],t.prototype,"librarySprite",void 0),s([A(cc.Button)],t.prototype,"assignmentButton",void 0),s([A(cc.Button)],t.prototype,"featuredButton",void 0),s([A(cc.Node)],t.prototype,"assignmentCount",void 0),s([A(cc.Prefab)],t.prototype,"preTestPopup",void 0),s([A(cc.Prefab)],t.prototype,"headerPrefab",void 0),s([A(cc.Node)],t.prototype,"header",void 0),s([A(cc.Node)],t.prototype,"rewardBg",void 0),s([R.default()],t.prototype,"onProfileClick",null),s([R.default()],t.prototype,"toAddGiftBoxNode",null),o=s([L],t)}(cc.Component);o.default=M,cc._RF.pop()},{"../../../chimple":void 0,"../../../common/scripts/chimple-label":void 0,"../../../common/scripts/friend":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/constants":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/lib/profile":void 0,"../../../common/scripts/loading":void 0,"../../../common/scripts/services/ServiceConfig":void 0,"../../../common/scripts/teacherAddedDialog":void 0,"../../../common/scripts/util":void 0,"../../../common/scripts/util-logger":void 0,"../../inventory/scripts/inventory":void 0,"../../rewards/scripts/rewards":void 0,"./assignmentPopup":"assignmentPopup","./chapterLessons":"chapterLessons","./lessonButton":"lessonButton","./reConnectPopup":"reConnectPopup","./startHeader":"startHeader"}]},{},["home","hotUpdate","assignmentPopup","chapterContent","chapterLessons","chapterMenuButton","courseChapters","courseContent","drawer","lessonButton","picDisplayPrefab","preTestDialog","reConnectPopup","start","startContent","startHeader","startHeaderButton"]);