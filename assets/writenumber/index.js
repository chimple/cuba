window.__require=function t(e,n,o){function i(c,s){if(!n[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var h=n[c]={exports:{}};e[c][0].call(h.exports,function(t){return i(e[c][1][t]||t)},h,h.exports,t,e,n,o)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<o.length;c++)i(o[c]);return i}({anim:[function(t,e,n){"use strict";cc._RF.push(e,"c1a23/FDA5BXKhzdnCenA9q","anim");var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,c=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,n,c):i(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.Anim=void 0;var c=cc._decorator.ccclass,s=t("../../../common/scripts/util"),a=t("./writenumber"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._position=null,e._containerNode=null,e._component=null,e._movedToRightPos=!1,e._animRunning=!1,e._touchEnabled=!1,e}return i(e,t),e.prototype.onLoad=function(){this.enableTouchHandlers(),this.node.scale=0,this._anim=this.node.getComponent(cc.Animation)},e.prototype.enableTouchHandlers=function(){this.node.on(s.TouchEvents.TOUCH_START,this.onTouchStart,this),this.node.on(s.TouchEvents.TOUCH_END,this.onTouchEnd,this)},e.prototype.disableTouchHandlers=function(){this.node.off(s.TouchEvents.TOUCH_START,this.onTouchStart,this),this.node.off(s.TouchEvents.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchStart=function(){this._component.touchAllowedOnAnimLayout&&this._movedToRightPos&&(this._touchEnabled||(this._touchEnabled=!0,this._component.updateSpeakCount(),this.animateOffScreen(),this._component.friend.speakEquation([String(this._component.speakCount)],function(){})))},e.prototype.animateOffScreen=function(){var t=this,e=s.Util.randomBetween(0,.3*cc.winSize.width);(new cc.Tween).target(this.node).to(1,{opacity:255,x:e,y:cc.winSize.width},{progress:null,easing:"cubicOut"}).call(function(){t.scheduleOnce(function(){t._component.updateAnimationIndexCount()},.1)}).start()},e.prototype.onTouchEnd=function(){},e.prototype.animateToScreen=function(){var t=this;this._animRunning=!0,this._anim.play("fly1"),(new cc.Tween).target(this.node).to(1.5,{scaleX:-1,scaleY:1,opacity:255,x:this._position.x,y:this._position.y},{progress:null,easing:"quadOut"}).call(function(){t._movedToRightPos=!0,t._anim.stop(),t._animRunning=!1}).start()},Object.defineProperty(e.prototype,"containerNode",{set:function(t){this._containerNode=t,this._component=this._containerNode.getComponent(a.WriteNumber)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{set:function(t){this._position=t},enumerable:!1,configurable:!0}),e.prototype.update=function(){this._component.touchAllowedOnAnimLayout&&!this._animRunning&&(this._animRunning=!0,this._anim.play("fly1"))},r([c],e)}(cc.Component);n.Anim=u,cc._RF.pop()},{"../../../common/scripts/util":void 0,"./writenumber":"writenumber"}],writenumber:[function(t,e,n){"use strict";cc._RF.push(e,"c8092ykRKdHVY+mvluDmXHA","writenumber");var o,i=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,c=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,n,c):i(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.WriteNumber=n.NUMBER_TRACING_TEXTURE=void 0;var c=cc._decorator.ccclass,s=cc._decorator.property,a=cc.Layout,u=t("../../../common/scripts/lib/config"),h=t("../../../common/scripts/util"),l=t("./anim"),d=t("../../../common/scripts/lib/error-handler"),p=t("../../../common/scripts/helper"),_=t("../../../common/Tracing/scripts/singlelettertracing"),m=t("../../../common/scripts/game");n.NUMBER_TRACING_TEXTURE="games/writenumber/textures/";var f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wordsPrefab=null,e.animsPrefab=null,e.progressMonitorPrefab=null,e.singleLetterPrefab=null,e.imageNode=null,e._currentConfig=null,e._numericTracingContainer=null,e._sound=null,e._words=null,e._anims=null,e._dog=null,e._currentLetterIndex=0,e._touchAllowedOnAnimLayout=!1,e._shouldShowAnimSprite=!0,e._animationFinishIndex=0,e}return i(e,t),e.prototype.onLoad=function(){var t=this;if(cc.director.getCollisionManager().enabled=!0,this._shouldShowAnimSprite=!0,this._shouldShowAnimSprite){var e=this.friend.node.y;this.friend.node.y+=cc.winSize.height,(new cc.Tween).target(this.friend.node).to(.25,{y:e},{progress:null,easing:"quadOut"}).call(function(){t.friend.playAnimation("throw",1),t.scheduleOnce(function(){t.buildAnimSprites(),t.scheduleOnce(function(){t._words.opacity=255,h.Util.showHelp(null,null)},2)},.65)}).start()}if(this._currentConfig=this.processConfiguration(u.default.getInstance().data[0]),null!==this._currentConfig){this._words=cc.instantiate(this.wordsPrefab),this.node.addChild(this._words);var n=(this._characters.length,.4),o=3===this._characters.length?660:2===this._characters.length?465:400;this._words.setPosition(new cc.Vec2(n*cc.winSize.width-o,100)),this._anims=cc.instantiate(this.animsPrefab),this.node.addChild(this._anims),this._anims.setPosition(new cc.Vec2(-cc.winSize.width/4,0)),this._anims.width=(1-n)*cc.winSize.width,this._anims.height=cc.winSize.height,this._numericTracingContainer=this.node,this._numericTracingContainer.scale*=1,this.node.width=cc.winSize.width,this.node.height=cc.winSize.height,this._speakCount=0,this._words.opacity=this._shouldShowAnimSprite?0:255,this.buildNumbers(),this.subScribeToTracingEvents(),this.node.emit(p.CONFIG_LOADED),this.emitLetterEnabledEvent(this._layout.node.getChildByName(this._originalLetterName+"0"),0),this.loadSounds(this._currentConfig.count)}},e.prototype.createSprite=function(t,e){var n=cc.instantiate(this.imageNode);n.setPosition(new cc.Vec2(850,200)),n.scale=0,n.opacity=255;var o=n.getComponent(l.Anim);t.addChild(n),o.containerNode=this.node,o.position=e,o.animateToScreen()},e.prototype.buildNumbers=function(){this.buildLayout()},e.prototype.buildLayout=function(){var t=this;this._layout=this._words.getComponent(cc.Layout),this._layout.node.zIndex=2,this._layout.spacingX=20,this._layout.spacingY=0,this._layout.resizeMode=a.ResizeMode.CONTAINER,this._words.setPosition(new cc.Vec2(this._words.getPosition().x,this._words.getPosition().y-50)),this._words.scale=.95,this._characters.forEach(function(e,n){var o=cc.instantiate(t.singleLetterPrefab);o.height=768,o.scale=1.25,t._originalLetterName=o.name,o.name=t._originalLetterName+n;var i=o.getComponent(_.SingleLetterTracing);i.wordTracingContainer=t.node,i.order=n,i.letter=e,t._layout.node.addChild(o),0===n&&(t._currentLetterIndex=n)}),this._layout.updateLayout()},e.prototype.buildAnimSprites=function(){this._animLayout=this._anims.getComponent(cc.Layout),this._animLayout.node.width=425,this._animLayout.node.setPosition(new cc.Vec2(-512,-350)),this._animLayout.type=a.Type.NONE,this._animLayout.resizeMode=a.ResizeMode.NONE,this._anims.scale=.85,this.generateAnimSprites(Number(this._currentConfig.count)),this._animLayout.updateLayout()},e.prototype.generateAnimSprites=function(t){Math.ceil(t/2),Math.floor(350/t);for(var e=t<3?400:Math.floor(800/Math.ceil(.5*t)),n=0;n<t;n++){var o=n%2==0?100:300;this.createSprite(this._animLayout.node,new cc.Vec2(o,e+e*Math.floor(n/2)))}},e.prototype.loadSounds=function(t){var e=this;h.Util.loadNumericSound(t,function(t){e._sound=t,e.node.emit(p.SOUND_LOADED_EVENT)})},e.prototype.subScribeToTracingEvents=function(){var t=this;this.node.on(p.TRACING_FINISHED,function(e){e.stopPropagation(),t.tracingFinished()}),this.node.on(p.TRACING_CORRECT,function(e){e.stopPropagation(),t.node.emit("correct")}),this.node.on(p.TRACING_WRONG,function(e){e.stopPropagation(),t.node.emit("wrong")}),this.node.on(p.RESET_TRACING,function(e){e.stopPropagation(),t._layout.node.getChildByName(t._originalLetterName+t._currentLetterIndex).getComponent(_.SingleLetterTracing).reset()}),this.node.on(p.RESET_TRACING_ALLOWED,function(){null!==t.node.getChildByName("reeetTracingButton")&&(t.node.getChildByName("reeetTracingButton").opacity=255)}),this.node.on(p.RESET_TRACING_NOT_ALLOWED,function(){null!==t.node.getChildByName("reeetTracingButton")&&(t.node.getChildByName("reeetTracingButton").opacity=0)}),null!==this.node.getChildByName("reeetTracingButton")&&(this.node.getChildByName("reeetTracingButton").opacity=0)},e.prototype.emitLetterEnabledEvent=function(t,e){t.emit("letterEnabledEvent",e,1)},e.prototype.tracingFinished=function(){this.pronounceAndTrigger()},e.prototype.individualLetterSound=function(){this._characters.length>1&&this._layout.node.getChildByName(this._originalLetterName+(this._currentLetterIndex-1)).getComponent(_.SingleLetterTracing).pronounce()},e.prototype.pronounceAndTrigger=function(){var t=this;this._currentLetterIndex++,this.individualLetterSound(),this._currentLetterIndex===this._characters.length?this.scheduleOnce(function(){t.friend.speak(t._sound),t.scheduleOnce(function(){t._touchAllowedOnAnimLayout=!0},.1)},1):this.emitLetterEnabledEvent(this._layout.node.getChildByName(this._originalLetterName+this._currentLetterIndex),this._currentLetterIndex)},e.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var e=[].concat.apply([],t),n=e[0],o=e[1],i=e[2],r=e[3];return this._characters=Array.from(r),{level:n,workSheet:o,problemNo:i,count:r}},e.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects()},e.prototype.moveToNext=function(){this._animationFinishIndex===Number(this._currentConfig.count)&&this._speakCount===Number(this._currentConfig.count)&&this.node.emit("nextProblem")},e.prototype.updateSpeakCount=function(){this._speakCount<Number(this._currentConfig.count)&&this._speakCount++},e.prototype.updateAnimationIndexCount=function(){this._animationFinishIndex<Number(this._currentConfig.count)&&this._animationFinishIndex++,this._animationFinishIndex===Number(this._currentConfig.count)&&this.moveToNext()},Object.defineProperty(e.prototype,"speakCount",{get:function(){return this._speakCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touchAllowedOnAnimLayout",{get:function(){return this._touchAllowedOnAnimLayout},enumerable:!1,configurable:!0}),r([s(cc.Prefab)],e.prototype,"wordsPrefab",void 0),r([s(cc.Prefab)],e.prototype,"animsPrefab",void 0),r([s(cc.Prefab)],e.prototype,"progressMonitorPrefab",void 0),r([s(cc.Prefab)],e.prototype,"singleLetterPrefab",void 0),r([s(cc.Prefab)],e.prototype,"imageNode",void 0),r([d.default()],e.prototype,"onLoad",null),r([d.default()],e.prototype,"createSprite",null),r([d.default()],e.prototype,"buildNumbers",null),r([d.default()],e.prototype,"buildLayout",null),r([d.default()],e.prototype,"buildAnimSprites",null),r([d.default()],e.prototype,"generateAnimSprites",null),r([d.default()],e.prototype,"subScribeToTracingEvents",null),r([d.default()],e.prototype,"emitLetterEnabledEvent",null),r([d.default()],e.prototype,"tracingFinished",null),r([d.default()],e.prototype,"individualLetterSound",null),r([d.default()],e.prototype,"pronounceAndTrigger",null),r([c],e)}(m.default);n.WriteNumber=f,cc._RF.pop()},{"../../../common/Tracing/scripts/singlelettertracing":void 0,"../../../common/scripts/game":void 0,"../../../common/scripts/helper":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./anim":"anim"}]},{},["anim","writenumber"]);