window.__require=function t(e,o,i){function n(c,a){if(!o[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var h=o[c]={exports:{}};e[c][0].call(h.exports,function(t){return n(e[c][1][t]||t)},h,h.exports,t,e,o,i)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)n(i[c]);return n}({choice:[function(t,e,o){"use strict";cc._RF.push(e,"4b089zJqNxODrOUgzoQlozN","choice");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./quiz"),a=t("../../../common/scripts/lib/error-handler"),s=t("../../../common/scripts/util"),l=cc._decorator,h=l.ccclass,p=l.property,u=null,d=null,f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.image=null,e.data=null,e.quizDir="",e.quizNode=null,e._graphics=null,e._touchStartPoint=null,e.enabled=!0,e}var o;return n(e,t),o=e,e.prototype.onLoad=function(){var t=this;if(this.quizNode.on(s.TouchEvents.TOUCH_START,this.onPageTouchStart,this),this.quizNode.on(s.TouchEvents.TOUCH_MOVE,this.onPageTouchMove,this),this.quizNode.on(s.TouchEvents.TOUCH_END,this.onPageTouchEnd,this),this._graphics=this.quizNode.parent.getChildByName("draw").getComponent(cc.Graphics),this._graphics.lineJoin=cc.Graphics.LineJoin.ROUND,this._graphics.lineCap=cc.Graphics.LineCap.ROUND,this._graphics.strokeColor=cc.Color.BLACK,this._graphics.lineWidth=20,this.data.type==c.QuizBtnType.Sentence)this.label.string=this.data.text;else{var e=this.node.width,o=this.node.height;s.Util.loadTexture(this.quizDir+this.data.pic,function(i){if(null!=i){t.image.spriteFrame=new cc.SpriteFrame(i);var n=t.image.spriteFrame.getOriginalSize(),r=e/n.width,c=o/n.height,a=Math.min(r,c);t.node.width=a*n.width,t.node.height=a*n.height}})}},e.prototype.onPageTouchStart=function(t){this.enabled&&(this.clear(),this.node.getBoundingBox().contains(this.node.parent.convertToNodeSpaceAR(t.getLocation()))&&(this._touchStartPoint=this.quizNode.parent.convertToNodeSpaceAR(t.getLocation()),u=this.data.matchName,d=this.node))},e.prototype.clear=function(){this._graphics.clear(),this._touchStartPoint=null},e.prototype.onPageTouchMove=function(t){if(this._touchStartPoint&&this.enabled){this._graphics.clear();var e=this.quizNode.parent.convertToNodeSpaceAR(t.getLocation());cc.log("touch move from",this._touchStartPoint," to",e),this._graphics.moveTo(this._touchStartPoint.x,this._touchStartPoint.y),this._graphics.lineTo(e.x,e.y),this._graphics.stroke()}},e.prototype.onPageTouchEnd=function(t){if(this.enabled&&(this.clear(),this.node.getBoundingBox().contains(this.node.parent.convertToNodeSpaceAR(t.getLocation()))))if(this.node.getComponent(o).data.matchName===u){this.node.opacity=100;var e=this.node.getComponent(o);e.enabled=!1;var i=d.getComponent(o);d.opacity=100,i.enabled=!1,e.node.dispatchEvent(new cc.Event.EventCustom(c.LINE_MATCH_CHOICE_CORRECT,!0))}else this.node.dispatchEvent(new cc.Event.EventCustom(c.LINE_MATCH_CHOICE_WRONG,!0))},r([p(cc.Label)],e.prototype,"label",void 0),r([p(cc.Sprite)],e.prototype,"image",void 0),r([a.default()],e.prototype,"onLoad",null),r([a.default()],e.prototype,"onPageTouchStart",null),r([a.default()],e.prototype,"clear",null),r([a.default()],e.prototype,"onPageTouchMove",null),r([a.default()],e.prototype,"onPageTouchEnd",null),o=r([h],e)}(cc.Component);o.default=f,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./quiz":"quiz"}],"fill-blanks-drag":[function(t,e,o){"use strict";cc._RF.push(e,"6437eZGIhFG+523YySIbCDT","fill-blanks-drag");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./quiz"),a=t("../../../common/scripts/drag"),s=cc._decorator,l=s.ccclass,h=(s.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.onTouchEnd=function(e){t.prototype.onTouchEnd.call(this,e),this.match?this.node.emit(c.FILL_IN_BLANKS_MATCH,this):this.node.emit(c.FILL_IN_BLANKS_NO_MATCH)},r([l],e)}(a.default));o.default=h,cc._RF.pop()},{"../../../common/scripts/drag":void 0,"./quiz":"quiz"}],"fill-blanks-drop":[function(t,e,o){"use strict";cc._RF.push(e,"2e5d8BCDJdCjo7l/PcdbLjT","fill-blanks-drop");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../common/scripts/drop"),a=t("../../../common/scripts/lib/error-handler"),s=cc._decorator,l=s.ccclass,h=(s.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.origWidth=0,e}return n(e,t),e.prototype.onLoad=function(){t.prototype.onLoad.call(this),this.origWidth=this.node.width},e.prototype.onCollisionEnter=function(e,o){t.prototype.onCollisionEnter.call(this,e,o),this.allowDrop&&(this.node.width=e.node.width)},e.prototype.onCollisionExit=function(e,o){t.prototype.onCollisionExit.call(this,e,o),this.allowDrop&&(this.node.width=this.origWidth)},r([a.default()],e.prototype,"onLoad",null),r([l],e)}(c.default));o.default=h,cc._RF.pop()},{"../../../common/scripts/drop":void 0,"../../../common/scripts/lib/error-handler":void 0}],"page-sound":[function(t,e,o){"use strict";cc._RF.push(e,"f2398RdqLhMcrZH1Dnm99kj","page-sound");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=t("../../../common/scripts/util"),s=t("../../../common/scripts/lib/error-handler"),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._isSoundPlaying=!1,e._soundClip=null,e._normalSpriteFrame=null,e._pressedSpriteFrame=null,e}return n(e,t),e.prototype.onLoad=function(){var t=this.node.getComponent(cc.Button);this._normalSpriteFrame=t.normalSprite,this._pressedSpriteFrame=t.pressedSprite},e.prototype.playSound=function(t){var e=this,o=t.getComponent(cc.Button);if(!this._isSoundPlaying){cc.audioEngine.stopAllEffects(),this._isSoundPlaying=!0,o.normalSprite=this._pressedSpriteFrame;var i=a.Util.play(this._soundClip,!1);cc.audioEngine.setFinishCallback(i,function(){e._isSoundPlaying=!1,o.normalSprite=e._normalSpriteFrame})}},e.prototype.stopSound=function(){this._isSoundPlaying=!1,cc.audioEngine.stopMusic(),this.node.getComponent(cc.Button).normalSprite=this._normalSpriteFrame},e.prototype.soundOnLoad=function(){this.playSound(this.node)},e.prototype.onButtonClick=function(t){var e=t.target;this.stopSound(),this.playSound(e)},Object.defineProperty(e.prototype,"soundClip",{set:function(t){this._soundClip=t},enumerable:!1,configurable:!0}),e.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects(),cc.audioEngine.stopMusic()},r([s.default()],e.prototype,"onLoad",null),r([c],e)}(cc.Component);o.default=l,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0}],"quiz-button":[function(t,e,o){"use strict";cc._RF.push(e,"c5590Jf0wBKCIbzkQluCQOP","quiz-button");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./quiz"),a=t("../../../common/scripts/lib/error-handler"),s=t("../../../common/scripts/util"),l=cc._decorator,h=l.ccclass,p=l.property,u=!0,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.label=null,e.image=null,e.data=null,e.quizDir="",e.quizNode=null,e}return n(e,t),e.prototype.onLoad=function(){var t=this;if(u=!0,this.data.type==c.QuizBtnType.Sentence)this.label.string=this.data.text;else{var e=this.node.width,o=this.node.height;s.Util.loadTexture(this.quizDir+this.data.pic,function(i){if(null!=i){t.image.spriteFrame=new cc.SpriteFrame(i);var n=t.image.spriteFrame.getOriginalSize(),r=e/n.width,c=o/n.height,a=Math.min(r,c);t.node.width=a*n.width,t.node.height=a*n.height}})}},e.prototype.makeInteractable=function(t){this.node.parent.children.forEach(function(e){e.getComponent(cc.Button).interactable=t,u=t})},e.prototype.onClick=function(){u&&(u=!1,this.makeInteractable(!1),this.data.correct?(this.node.dispatchEvent(new cc.Event.EventCustom(c.MULTI_CHOICE_CORRECT,!0)),this.makeInteractable(!1)):(this.node.dispatchEvent(new cc.Event.EventCustom(c.MULTI_CHOICE_WRONG,!0)),this.makeInteractable(!0)))},r([p(cc.Label)],e.prototype,"label",void 0),r([p(cc.Sprite)],e.prototype,"image",void 0),r([a.default()],e.prototype,"onLoad",null),r([a.default()],e.prototype,"makeInteractable",null),r([h],e)}(cc.Component);o.default=d,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./quiz":"quiz"}],"quiz-tracing":[function(t,e,o){"use strict";cc._RF.push(e,"2a395j5Ke9As4MWH79KTOf5","quiz-tracing");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,a=cc._decorator.property,s=t("../../../common/scripts/lib/error-handler"),l=t("../../../common/Tracing/scripts/singlelettertracing"),h=t("../../../common/scripts/util"),p=t("../../../common/scripts/helper"),u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.words=null,e.singleLetterPrefab=null,e.characters=[],e._currentLetterIndex=0,e}return n(e,t),e.prototype.onLoad=function(){var t=this;if(1===this.currentConfig.choices.length){var e=this.currentConfig.choices[0].toUpperCase();this.characters=e.split("");var o=this.words.getComponent(cc.Layout);p.Helper.subScribeToTracingEvents(this.node,this.node,this.tracingFinished.bind(this)),this.words.setPosition(new cc.Vec2(cc.winSize.width,this.words.getPosition().y)),p.Helper.buildLetters(this.node,this.words,this.characters,this.singleLetterPrefab,cc.winSize.width-100,cc.winSize.height),this.node.emit(p.CONFIG_LOADED),this.emitLetterEnabledEvent(o.node.getChildByName("L0"),0),this.node.on(p.MOVE_TO_NEXT_LETTER_EVENT,function(e){e.stopPropagation();var o=e.getUserData();t.moveToNextLetter(o)})}},e.prototype.tracingFinished=function(){this.words.getComponent(cc.Layout).node.getChildByName("L"+this._currentLetterIndex).getComponent(l.SingleLetterTracing).pronounce();var t=new cc.Event.EventCustom(p.MOVE_TO_NEXT_LETTER_EVENT,!0);this._currentLetterIndex++,t.setUserData({elementIndex:this._currentLetterIndex}),this.node.dispatchEvent(t)},e.prototype.emitLetterEnabledEvent=function(t,e){t.emit("letterEnabledEvent",e)},e.prototype.moveToNextLetter=function(t){var e=this,o=t.elementIndex,i=this.words.getComponent(cc.Layout);if(o<=this.characters.length-1){var n=i.node.getChildByName("L"+o);this.minScrollToLeft(o,n),this.scrollToLeft(o,n)}else{var r=this.quizDir+this.currentConfig.choicesSound+".mp3";this.scheduleOnce(function(){h.Util.speak(r,function(){e.node.dispatchEvent(new cc.Event.EventCustom(p.GO_TO_NEXT_PROBLEM,!0))})},1)}},e.prototype.minScrollToLeft=function(t){var e=cc.winSize.width/4,o=this.words.getComponent(cc.Layout),i=new cc.Vec2(o.node.position.x-e,o.node.position.y);this.tweenMove(o,i,t)},e.prototype.tweenMove=function(t,e,o){var i=this;(new cc.Tween).target(t.node).to(.5,{position:e},{progress:null,easing:"sineOut"}).call(function(){i.emitLetterEnabledEvent(t.node.getChildByName("L"+o),o)}).start()},e.prototype.scrollToLeft=function(t,e){var o=this.words.getComponent(cc.Layout);if(e.position.x-Math.abs(o.node.position.x/2)+1*e.width>3*cc.winSize.width/4){var i=1.1*e.width,n=new cc.Vec2(o.node.position.x-i,o.node.position.y);this.tweenMove(o,n,t)}else this.minScrollToLeft(t,e)},r([a(cc.Node)],e.prototype,"words",void 0),r([a(cc.Prefab)],e.prototype,"singleLetterPrefab",void 0),r([s.default()],e.prototype,"onLoad",null),r([s.default()],e.prototype,"tracingFinished",null),r([s.default()],e.prototype,"emitLetterEnabledEvent",null),r([s.default()],e.prototype,"moveToNextLetter",null),r([s.default()],e.prototype,"minScrollToLeft",null),r([s.default()],e.prototype,"tweenMove",null),r([s.default()],e.prototype,"scrollToLeft",null),r([c],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../../../common/Tracing/scripts/singlelettertracing":void 0,"../../../common/scripts/helper":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0}],quiz:[function(t,e,o){"use strict";cc._RF.push(e,"f9db4QLwLZCkazRBqZcNazn","quiz");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.ChoiceData=o.BtnData=o.QuizBtnType=o.LINE_MATCH_CHOICE_WRONG=o.LINE_MATCH_CHOICE_CORRECT=o.MULTI_CHOICE_WRONG=o.MULTI_CHOICE_CORRECT=o.FILL_IN_BLANKS_NO_MATCH=o.FILL_IN_BLANKS_MATCH=void 0;var c,a=cc._decorator.ccclass,s=cc._decorator.property,l=t("./page-sound"),h=t("./quiz-tracing"),p=t("./fill-blanks-drag"),u=t("./fill-blanks-drop"),d=t("./quiz-button"),f=t("./choice"),_=t("../../../common/scripts/lib/config"),g=t("../../../common/scripts/lib/error-handler"),m=t("../../../common/scripts/util"),y=t("../../../common/scripts/chimple-label"),C=t("../../../common/scripts/drag"),v=t("../../../common/scripts/helper");o.FILL_IN_BLANKS_MATCH="fillInBlanksMatch",o.FILL_IN_BLANKS_NO_MATCH="fillInBlanksNoMatch",o.MULTI_CHOICE_CORRECT="multiChoiceCorrect",o.MULTI_CHOICE_WRONG="multiChoiceWrong",o.LINE_MATCH_CHOICE_CORRECT="lineMatchChoiceCorrect",o.LINE_MATCH_CHOICE_WRONG="lineMatchChoiceWrong",function(t){t[t.Sentence=0]="Sentence",t[t.Picture=1]="Picture"}(c=o.QuizBtnType||(o.QuizBtnType={}));var b=function(t,e,o,i){this.correct=t,this.type=e,this.text=o,this.pic=i};o.BtnData=b;var L=function(t,e,o,i){this.matchName=t,this.type=e,this.text=o,this.pic=i};o.ChoiceData=L;var w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._soundClip=null,e._page=null,e._quizDir=null,e._soundDir=null,e.titleSection=null,e.middleSection=null,e.imageSection=null,e.bottomSection=null,e.bottomSectionLayout=null,e.quizTracing=null,e.fillBlankDrag=null,e.fillBlankDrop=null,e.textsLayout=null,e.quizLabel=null,e._titleSection=null,e._fillInBlanksMap=new Map,e._maxAnswerLengthF=0,e._fillInBlanksDropTokens=[],e._fillInBlanksCount=0,e._imagesAsChoicesInMC=!1,e._middleSectionNode=null,e._lineMatchingCount=0,e}return n(e,t),e.prototype.onEnable=function(){cc.director.getCollisionManager().enabled=!0},e.prototype.onLoad=function(){var t=_.default.getInstance();this.registerNotifications(),this._currentConfig=this.processConfiguration(_.default.getInstance().data[0]),this._quizDir=_.default.dir+(t.lesson.id+"/res/"),this._soundDir=_.default.dir+(t.lesson.id+"/res/"),this._page=this.node,this._currentConfig=this.processConfiguration(_.default.getInstance().data[0]),console.log("quiz",JSON.stringify(this._currentConfig)),this.renderTitle(this._currentConfig.title),this.loadTitleSound(),this.renderMiddleSection(),this.renderBottomSection()},e.prototype.registerNotifications=function(){var t=this;this.node.on("ADJUST_FILL_IN_BLANKS",function(){t.adjustFillInBlanks()}),this.node.on(v.GO_TO_NEXT_PROBLEM,function(e){e.stopPropagation(),t.scheduleOnce(function(){t.node.parent.emit("nextProblem")},1)}),this.node.on(o.MULTI_CHOICE_WRONG,function(e){e.stopPropagation(),t.node.parent.emit("wrong")}),this.node.on(o.MULTI_CHOICE_CORRECT,function(e){e.stopPropagation(),t.node.parent.emit("correct"),t.scheduleOnce(function(){t.node.parent.emit("nextProblem")},1)}),this.node.on(o.LINE_MATCH_CHOICE_WRONG,function(e){e.stopPropagation(),t.node.parent.emit("wrong")}),this.node.on(o.LINE_MATCH_CHOICE_CORRECT,function(e){e.stopPropagation(),t.node.parent.emit("correct"),t._lineMatchingCount--,t._lineMatchingCount<=0&&t.scheduleOnce(function(){t.node.parent.emit("nextProblem")},1)})},e.prototype.adjustFillInBlanks=function(){this._fillInBlanksDropTokens.forEach(function(t){var e=t.getComponent(u.default),o=t.getComponent(cc.BoxCollider),i=t.getChildByName("dropLabel");t.width=e.allowDrop?t.width:i.width,t.height=i.height,o.size=e.allowDrop?new cc.Size(t.width,t.height):new cc.Size(0,0)})},e.prototype.loadImage=function(t,e){var o=cc.instantiate(this.imageSection);o.active=!1,t.addChild(o);var i=o.width,n=o.height;m.Util.loadTexture(this._quizDir+e,function(t,e){if(t&&!e){o.active=!0,o.setPosition(new cc.Vec2(0,0));var r=o.getComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(t);var c=r.spriteFrame.getOriginalSize(),a=i/c.width,s=n/c.height,l=Math.min(a,s);o.width=l*c.width,o.height=l*c.height}})},e.prototype.loadTitleSound=function(){var t=this,e=this._titleSection.getChildByName("soundButton");this._currentConfig.soundFile?m.Util.loadGameSound(this._quizDir+this._currentConfig.soundFile+".mp3",function(o){t._soundClip=o,e&&(e.getComponent(l.default).soundClip=t._soundClip,e.active=!!t._currentConfig.soundFile)}):e&&(e.active=!1)},e.prototype.renderMiddleSection=function(){switch(this._currentConfig.type){case"T":this._middleSectionNode=cc.instantiate(this.middleSection),this._page.addChild(this._middleSectionNode),this.loadImage(this._middleSectionNode,this._currentConfig.image),this._middleSectionNode.setPosition(new cc.Vec2(0,100));break;case"F":this._middleSectionNode=cc.instantiate(this.middleSection),this._page.addChild(this._middleSectionNode),this.loadImage(this._middleSectionNode,this._currentConfig.image),this.loadSentences(this._middleSectionNode),this._middleSectionNode.setPosition(new cc.Vec2(0,-50));break;case"MC":this._currentConfig.question&&(this._middleSectionNode=cc.instantiate(this.middleSection),this._page.addChild(this._middleSectionNode),this.loadQuestion(this._middleSectionNode),this.loadChoices())}},e.prototype.loadChoices=function(){var t=this,e=this._imagesAsChoicesInMC?c.Picture:c.Sentence,o=this._currentConfig.correctAnswers&&1===this._currentConfig.correctAnswers.length?this._currentConfig.correctAnswers[0].trim():null;return this._currentConfig.choices.map(function(i){var n=new b(o===i.trim(),e,i,i);return t.createChoice(n)})},e.prototype.createChoice=function(t,e){void 0===e&&(e=!0);var o=e?cc.instantiate(t.type==c.Sentence?this.textChoiceButtonPrefab:this.imageChoiceButtonPrefab):cc.instantiate(this.choicePrefab);o.name=t.type==c.Sentence?t.text:t.pic;var i=e?o.getComponent(d.default):o.getComponent(f.default);return null!=i&&(i.quizDir=this._quizDir,i.data=t,i.quizNode=this.node),o},e.prototype.getLabel=function(t){var e=cc.instantiate(this.quizLabel);return e.getComponent(cc.Label).string=t,e},e.prototype.loadQuestion=function(t){var e=this.getLabel(this._currentConfig.question);t.addChild(e),t.height=150,t.setPosition(new cc.Vec2(0,100))},e.prototype.loadSentences=function(t){var e=this,o=cc.instantiate(this.textsLayout);t.addChild(o),o.setPosition(new cc.Vec2(0,-75)),this._currentConfig.sentences.forEach(function(t,i){var n=t.split(/[\s.,]+/),r=e._fillInBlanksMap.get(i)||[],c=0;n.forEach(function(t){var i=cc.instantiate(e.fillBlankDrop),n=i.getChildByName("dropLabel").getComponent(cc.Label),a=i.getComponent(u.default);if("#"===t){var s=r.length>c?r[c]:"";c++,i.name=s,n.string="     ",a.allowDrop=!0,i.width=30*e._maxAnswerLengthF,e._fillInBlanksCount++}else{var l=i.getComponent(cc.Sprite);i.removeComponent(l),n.string=t,a.allowDrop=!1,i.width=0,i.name=t}e._fillInBlanksDropTokens.push(i),o.addChild(i)}),e.node.emit("ADJUST_FILL_IN_BLANKS")})},e.prototype.renderBottomSection=function(){var t=this;switch(this._currentConfig.type){case"T":var e=cc.instantiate(this.bottomSection);e.width=cc.winSize.width-100,e.height=cc.winSize.height/2;var i=cc.instantiate(this.quizTracing),n=i.getComponent(h.default);n.quizDir=this._quizDir,n.currentConfig=this._currentConfig,i.setPosition(new cc.Vec2(0,0)),e.addChild(i),e.setPosition(0,-225),this._page.addChild(e);break;case"F":var r=cc.instantiate(this.bottomSectionLayout);r.width=cc.winSize.width-100,r.height=cc.winSize.height/4,this._currentConfig.choices.forEach(function(e){var i=cc.instantiate(t.fillBlankDrag);i.name=e,i.on(o.FILL_IN_BLANKS_MATCH,t.onMatch.bind(t)),i.on(o.FILL_IN_BLANKS_NO_MATCH,function(){t.node.parent.emit("wrong")});var n=i.getComponent(p.default);null!=n&&(n.label.string=e);var c=new cc.Node;c.name=e,c.addChild(i),r.addChild(c)}),r.setPosition(0,-300),this._page.addChild(r);break;case"MC":var a=cc.instantiate(this.bottomSectionLayout);if(a.width=cc.winSize.width,a.height=300,this._imagesAsChoicesInMC)this.loadChoices().forEach(function(t){a.addChild(t)});else{var s=this.getVerticalLayout();this.loadImage(a,this._currentConfig.image),this.loadChoices().forEach(function(t){s.addChild(t)}),a.addChild(s)}this._middleSectionNode?a.setPosition(0,-cc.winSize.height/4):a.setPosition(0,0),this._page.addChild(a);break;case"M":var l=cc.instantiate(this.bottomSectionLayout);l.width=cc.winSize.width;var u=this.getVerticalLayout(cc.Layout.ResizeMode.CHILDREN),d=this._currentConfig.choices&&1===this._currentConfig.choices.length&&this._currentConfig.choices[0].split(",")||[],f=this._currentConfig.sentences&&1===this._currentConfig.sentences.length&&this._currentConfig.sentences[0].split(",")||[];f.forEach(function(e){var o=new L(e,c.Sentence,e,e),i=t.createChoice(o,!1);i.height=100,i.width=350,i.children.forEach(function(t){t.height=t.width=100,t.width=350}),u.addChild(i)});var _=this.getVerticalLayout(cc.Layout.ResizeMode.CHILDREN),g=0;this._lineMatchingCount=d.length;var y=d.map(function(e,o){var i=new L(f[o],c.Picture,e,e),n=t.createChoice(i,!1);return n.height=Math.min((cc.winSize.height-100)/t._lineMatchingCount,150),n.width=n.height=150,n.children.forEach(function(t){t.height=t.width=150}),g+=n.height,n});(y=m.Util.randomElements(y,y.length)).forEach(function(t){return _.addChild(t)}),u.height=_.height=g+100,l.addChild(u),l.addChild(_),this._middleSectionNode?l.setPosition(0,-cc.winSize.height/4):l.setPosition(0,-cc.winSize.height/8),this._page.addChild(l)}},e.prototype.renderTitle=function(t){this._titleSection=cc.instantiate(this.titleSection),this._titleSection.setPosition(new cc.Vec2(0,275)),this._page.addChild(this._titleSection);var e=this._titleSection.getChildByName("titleText");e&&(e.getComponent(y.default).string=t)},e.prototype.getVerticalLayout=function(t){void 0===t&&(t=cc.Layout.ResizeMode.CONTAINER);var e=cc.instantiate(this.textsLayout),o=e.getComponent(cc.Layout);return o.type=cc.Layout.Type.VERTICAL,o.resizeMode=t,o.paddingTop=o.paddingBottom=5,o.spacingY=10,o.verticalDirection=cc.Layout.VerticalDirection.TOP_TO_BOTTOM,e},e.prototype.processConfiguration=function(t){var e=this;void 0===t&&(t=[]);var o,i,n,r,c=[].concat.apply([],t),a=(c[0],c[1],c[2],c[3]),s=c[4],l=c.slice(5),h=[],p=[],u=[],d=[];switch(s){case"F":if(5===l.length){o=l[0],n=l[1];var f=l[2].split("/");f.forEach(function(t,o){var i=t.match(/\[(.*?)\]/g)||[],n=f[o].trim();if(n&&n.length>0){var r=[];i.forEach(function(t){n=n.replace(t,"#");var o=t.replace("[","").replace("]","");r.push(o),e._maxAnswerLengthF=o.length>e._maxAnswerLengthF?o.length:e._maxAnswerLengthF,p.push(o),d.push(o)}),e._fillInBlanksMap.set(o,r),h.push(n)}}),p.push(l[3]),i=l[4]}break;case"T":5===l.length&&(o=l[0],i=l[1],n=l[2],p.push(l[3]),u.push(l[4]));break;case"MC":4===l.length?(o=l[0],l[1].endsWith(".png")?n=l[1]:r=l[1],this._imagesAsChoicesInMC=-1!==l[2].indexOf(".png"),p=l[2].split(","),d.push(l[3])):5===l.length&&(o=l[0].trim(),l[1].endsWith(".png")?n=l[1]:r=l[1],n=l[2],this._imagesAsChoicesInMC=-1!==l[3].indexOf(".png"),p=l[3].split(","),d.push(l[4].trim()));break;case"M":3===l.length&&(o=l[0],h.push(l[1]),p.push(l[2]))}return{pageNo:a,type:s,title:o,soundFile:i,question:r,sentences:h,choices:p,choicesSound:u,correctAnswers:d,image:n}},e.prototype.onMatch=function(){this.node.parent.emit("correct"),C.default.letDrag=!1,this._fillInBlanksCount--,this._fillInBlanksCount<=0&&this.node.parent.emit("nextProblem")},r([s(cc.Prefab)],e.prototype,"titleSection",void 0),r([s(cc.Prefab)],e.prototype,"middleSection",void 0),r([s(cc.Prefab)],e.prototype,"imageSection",void 0),r([s(cc.Prefab)],e.prototype,"bottomSection",void 0),r([s(cc.Prefab)],e.prototype,"bottomSectionLayout",void 0),r([s(cc.Prefab)],e.prototype,"quizTracing",void 0),r([s(cc.Prefab)],e.prototype,"fillBlankDrag",void 0),r([s(cc.Prefab)],e.prototype,"fillBlankDrop",void 0),r([s(cc.Prefab)],e.prototype,"textsLayout",void 0),r([s(cc.Prefab)],e.prototype,"quizLabel",void 0),r([s(cc.Prefab)],e.prototype,"textChoiceButtonPrefab",void 0),r([s(cc.Prefab)],e.prototype,"imageChoiceButtonPrefab",void 0),r([s(cc.Prefab)],e.prototype,"choicePrefab",void 0),r([g.default()],e.prototype,"onEnable",null),r([g.default()],e.prototype,"onLoad",null),r([g.default()],e.prototype,"registerNotifications",null),r([g.default()],e.prototype,"adjustFillInBlanks",null),r([g.default()],e.prototype,"loadImage",null),r([g.default()],e.prototype,"loadTitleSound",null),r([g.default()],e.prototype,"renderMiddleSection",null),r([g.default()],e.prototype,"loadChoices",null),r([g.default()],e.prototype,"createChoice",null),r([g.default()],e.prototype,"getLabel",null),r([g.default()],e.prototype,"loadQuestion",null),r([g.default()],e.prototype,"loadSentences",null),r([g.default()],e.prototype,"renderBottomSection",null),r([g.default()],e.prototype,"renderTitle",null),r([g.default()],e.prototype,"getVerticalLayout",null),r([a],e)}(cc.Component);o.default=w,cc._RF.pop()},{"../../../common/scripts/chimple-label":void 0,"../../../common/scripts/drag":void 0,"../../../common/scripts/helper":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./choice":"choice","./fill-blanks-drag":"fill-blanks-drag","./fill-blanks-drop":"fill-blanks-drop","./page-sound":"page-sound","./quiz-button":"quiz-button","./quiz-tracing":"quiz-tracing"}]},{},["choice","fill-blanks-drag","fill-blanks-drop","page-sound","quiz-button","quiz-tracing","quiz"]);