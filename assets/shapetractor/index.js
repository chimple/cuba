window.__require=function t(e,r,o){function n(i,c){if(!r[i]){if(!e[i]){var p=i.split("/");if(p=p[p.length-1],!e[p]){var l="function"==typeof __require&&__require;if(!c&&l)return l(p,!0);if(a)return a(p,!0);throw new Error("Cannot find module '"+i+"'")}i=p}var s=r[i]={exports:{}};e[i][0].call(s.exports,function(t){return n(e[i][1][t]||t)},s,s.exports,t,e,r,o)}return r[i].exports}for(var a="function"==typeof __require&&__require,i=0;i<o.length;i++)n(o[i]);return n}({patterntrainDrag:[function(t,e,r){"use strict";cc._RF.push(e,"96333ZTyOhGy6Vt492j+m1D","patterntrainDrag");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=this&&this.__decorate||function(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(i=(a<3?n(i):a>3?n(e,r,i):n(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i};Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../common/scripts/drag"),c=cc._decorator,p=c.ccclass,l=c.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pattern=null,e.patterntrain=null,e}return n(e,t),e.prototype.onTouchEnd=function(e){t.prototype.onTouchEnd.call(this,e),this.isDragging&&(this.match?this.patterntrain.emit("patterntrainMatch",this):this.patterntrain.emit("patterntrainNoMatch"))},a([l(cc.Sprite)],e.prototype,"pattern",void 0),a([l(cc.Node)],e.prototype,"patterntrain",void 0),a([p],e)}(i.default);r.default=s,cc._RF.pop()},{"../../../common/scripts/drag":void 0}],patterntrainDrop:[function(t,e,r){"use strict";cc._RF.push(e,"a8067jtko9PFLADt8d6rwY9","patterntrainDrop");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=this&&this.__decorate||function(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(i=(a<3?n(i):a>3?n(e,r,i):n(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i};Object.defineProperty(r,"__esModule",{value:!0});var i=t("../../../common/scripts/drop"),c=cc._decorator,p=c.ccclass,l=(c.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),a([p],e)}(i.default));r.default=l,cc._RF.pop()},{"../../../common/scripts/drop":void 0}],shapetractor:[function(t,e,r){"use strict";cc._RF.push(e,"1e6f07b/oZANqQsqZCfgNY+","shapetractor");var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),a=this&&this.__decorate||function(t,e,r,o){var n,a=arguments.length,i=a<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var c=t.length-1;c>=0;c--)(n=t[c])&&(i=(a<3?n(i):a>3?n(e,r,i):n(e,r))||i);return a>3&&i&&Object.defineProperty(e,r,i),i},i=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var o=Array(t),n=0;for(e=0;e<r;e++)for(var a=arguments[e],i=0,c=a.length;i<c;i++,n++)o[n]=a[i];return o};Object.defineProperty(r,"__esModule",{value:!0});var c=t("./patterntrainDrag"),p=t("../../../common/scripts/lib/config"),l=t("../../../common/scripts/drag"),s=t("../../../common/scripts/lib/error-handler"),u=t("../../../common/scripts/util"),f=t("../../../common/scripts/game"),h=cc._decorator,d=h.ccclass,g=h.property,y=["dummy","circle","hexagon","octagon","oval","parallelogram","pentagon","rectangle","rhombus","square","star","trapezoid","triangle"],m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.drag=null,e.drop=null,e.trainBogey=null,e.threeCarBogey=null,e.choices=null,e.train=null,e.trainClip=null,e.circle=null,e.hexagon=null,e.octagon=null,e.oval=null,e.parallelogram=null,e.pentagon=null,e.rectangle=null,e.rhombus=null,e.square=null,e.star=null,e.trapezoid=null,e.triangle=null,e.empty=0,e.firstDrag=null,e.firstDrop=null,e}return n(e,t),e.prototype.onLoad=function(){var t=this;cc.director.getCollisionManager().enabled=!0,l.default.letDrag=!1,this.node.on("patterntrainMatch",this.onMatch.bind(this)),this.node.on("patterntrainNoMatch",function(){t.node.emit("wrong")});var e=p.default.getInstance().data[0],r=(e[0],e[1],e[2],e[3]),o=e[4],n=parseInt(r),a=parseInt(o),i=this.generatePatterns(n,a),s=n>=4?Math.floor(Math.random()*(y.length-1))+1:0;i.forEach(function(e,r){t.addBogey(e,r,s)});var f=n>=4?[1,2,3]:i[0];for(f=f.filter(function(t,e){return f.indexOf(t)===e});f.length<i[0].length;){var h=Math.floor(Math.random()*(y.length-1))+1;-1==f.indexOf(h)&&f.push(h)}u.Util.shuffle(f),f.forEach(function(e){var r=cc.instantiate(t.drag);r.name=e.toString();var o=r.getComponent(c.default);o.pattern.spriteFrame=t[y[s>0?s:e]],s>0&&(o.pattern.node.scale=1/e),o.patterntrain=t.node;var n=new cc.Node;n.width=r.width,n.height=r.height,n.addChild(r),t.choices.addChild(n),r.name==t.firstDrop.name&&null==t.firstDrag&&(t.firstDrag=r)});var d=this.train.x;(new cc.Tween).target(this.train).call(function(){u.Util.playSfx(t.trainClip)}).set({x:d+cc.winSize.width}).to(3,{x:d},{progress:null,easing:"backOut"}).call(function(){l.default.letDrag=!0,u.Util.showHelp(t.firstDrag,t.firstDrop)}).start()},e.prototype.addBogey=function(t,e,r){var o=this,n=cc.instantiate(this.trainBogey),a=n.getChildByName("cargo");if(3==t.length){var i=n.getChildByName("car");null!=i&&(i.getComponent(cc.Sprite).spriteFrame=this.threeCarBogey,i.width=444,n.width=444)}null!=a&&t.forEach(function(t){if(t>0){var e=cc.instantiate(o.drag),n=e.getComponent(c.default);n.allowDrag=!1,n.pattern.spriteFrame=o[y[r>0?r:t]],r>0&&(n.pattern.node.scale=1/t),a.addChild(e)}else{var i=cc.instantiate(o.drop);null!=i&&(i.name=(-t).toString()),a.addChild(i),null==o.firstDrop&&(o.firstDrop=i)}}),this.train.addChild(n),(new cc.Tween).target(n).set({x:40*(e+1)}).delay(2).to(1,{x:0},{progress:null,easing:"sineIn"}).start()},e.prototype.onMatch=function(){var t=this;this.node.emit("correct"),--this.empty<=0&&(l.default.letDrag=!1,(new cc.Tween).target(this.train).delay(1).call(function(){u.Util.playSfx(t.trainClip)}).to(1,{x:this.train.x-cc.winSize.width},{progress:null,easing:"backIn"}).call(function(){t.node.emit("nextProblem")}).start())},e.prototype.generatePatterns=function(t,e){switch(t){case 1:if(this.empty=1,1==e){var r=Math.floor(Math.random()*(y.length-1))+1;return this.generateSequence(2,2,r,r+1)}return this.generateSequence(2,2,1,y.length);case 2:return this.empty=1,this.generateSequence(3,2,1,y.length);case 3:return this.empty=2,this.generateSequence(3,2,1,y.length);case 4:return this.empty=2,this.generateSequence(2,3,1,4);case 5:return this.empty=3,this.generateSequence(3,2,1,4)}},e.prototype.generateSequence=function(t,e,r,o){for(var n=this.empty,a=[],c=[],p=0;p<t;p++)c.push(Math.floor(Math.random()*(o-r))+r);for(a.push(c),p=0;p<e-1;p++)a.push(i(c));for(var l=a[a.length-1];n>0;)l[p=Math.floor(Math.random()*t)]>0&&(l[p]*=-1,n--);return a},a([g(cc.Prefab)],e.prototype,"drag",void 0),a([g(cc.Prefab)],e.prototype,"drop",void 0),a([g(cc.Prefab)],e.prototype,"trainBogey",void 0),a([g(cc.SpriteFrame)],e.prototype,"threeCarBogey",void 0),a([g(cc.Node)],e.prototype,"choices",void 0),a([g(cc.Node)],e.prototype,"train",void 0),a([g(cc.AudioClip)],e.prototype,"trainClip",void 0),a([g(cc.SpriteFrame)],e.prototype,"circle",void 0),a([g(cc.SpriteFrame)],e.prototype,"hexagon",void 0),a([g(cc.SpriteFrame)],e.prototype,"octagon",void 0),a([g(cc.SpriteFrame)],e.prototype,"oval",void 0),a([g(cc.SpriteFrame)],e.prototype,"parallelogram",void 0),a([g(cc.SpriteFrame)],e.prototype,"pentagon",void 0),a([g(cc.SpriteFrame)],e.prototype,"rectangle",void 0),a([g(cc.SpriteFrame)],e.prototype,"rhombus",void 0),a([g(cc.SpriteFrame)],e.prototype,"square",void 0),a([g(cc.SpriteFrame)],e.prototype,"star",void 0),a([g(cc.SpriteFrame)],e.prototype,"trapezoid",void 0),a([g(cc.SpriteFrame)],e.prototype,"triangle",void 0),a([s.default()],e.prototype,"onLoad",null),a([s.default()],e.prototype,"onMatch",null),a([d],e)}(f.default);r.default=m,cc._RF.pop()},{"../../../common/scripts/drag":void 0,"../../../common/scripts/game":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./patterntrainDrag":"patterntrainDrag"}]},{},["patterntrainDrag","patterntrainDrop","shapetractor"]);