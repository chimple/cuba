window.__require=function t(e,o,n){function r(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var p=o[c]={exports:{}};e[c][0].call(p.exports,function(t){return r(e[c][1][t]||t)},p,p.exports,t,e,o,n)}return o[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<n.length;c++)r(n[c]);return r}({left:[function(t,e,o){"use strict";cc._RF.push(e,"2772dr2wV5DJ5pXYoO3qIJg","left");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.onLoad=function(){},i([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}],"nav-button":[function(t,e,o){"use strict";cc._RF.push(e,"faaebRKxZ5Mh6CYTO/nCbf6","nav-button");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,s=t("./story-page"),a=t("../../../common/scripts/lib/error-handler"),l=!0,p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.onLoad=function(){l=!0},e.prototype.onClick=function(t,e){l&&(l=!1,this.node.parent.getComponent(s.StoryPage).changePage(Number(e)))},i([a.default()],e.prototype,"onLoad",null),i([a.default()],e.prototype,"onClick",null),i([c],e)}(cc.Component);o.default=p,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"./story-page":"story-page"}],right:[function(t,e,o){"use strict";cc._RF.push(e,"69f6e/u5kpACIaUR+dUW1em","right");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../common/scripts/lib/error-handler"),s=t("../../../common/scripts/chimple-richtext"),a=cc._decorator,l=a.ccclass,p=(a.property,function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lastIndex=-1,e.storyText=null,e.words=null,e}return r(e,t),e.prototype.Handler=function(t,e){var o=e.split("_"),n=o[0],r=o[1];this.speakAndHighLight(n,r,"#000000","#ff0000")},e.prototype.speakAndHighLight=function(t,e,o,n){var r=this;cc.log("storyText",this.storyText,"word to highlight",t),this.highlight(t,e,o,n);var i=this.words.get(t);try{if(i){var c=cc.audioEngine.playEffect(i,!1);cc.audioEngine.setFinishCallback(c,function(){r.noHighlight(t,e,"#ff0000","#000000")})}else this.noHighlight(t,e,"#ff0000","#000000")}catch(s){}},e.prototype.highlight=function(t,e,o,n,r){void 0===r&&(r=!1);var i='color="'+o+'" param="'+t+"_"+e+'"',c='color="'+n+'" param="'+t+"_"+e+'"';r?(this.lastIndex>-1?this.node.getComponent(s.default).string=this.storyText.slice(0,this.lastIndex)+this.storyText.slice(this.lastIndex).replace(i,c):this.node.getComponent(s.default).string=this.storyText.replace(i,c),cc.log("this.storyText after highlight",this.node.getComponent(s.default).string),this.lastIndex=this.storyText.indexOf(t)>this.lastIndex?this.storyText.indexOf(t):this.lastIndex):this.node.getComponent(s.default).string=this.storyText.replace(i,c)},e.prototype.noHighlight=function(t,e,o,n){var r='color="'+o+'" param="'+t+"_"+e+'"',i='color="'+n+'" param="'+t+"_"+e+'"';this.node.getComponent(s.default).string=this.storyText.replace(r,i),cc.log("this.storyText after no highlight",this.node.getComponent(s.default).string)},i([c.default()],e.prototype,"Handler",null),i([c.default()],e.prototype,"speakAndHighLight",null),i([c.default()],e.prototype,"highlight",null),i([c.default()],e.prototype,"noHighlight",null),i([l],e)}(cc.Component));o.default=p,cc._RF.pop()},{"../../../common/scripts/chimple-richtext":void 0,"../../../common/scripts/lib/error-handler":void 0}],selector:[function(t,e,o){"use strict";cc._RF.push(e,"31778Y2NMdLW7xWIl8F58d2","selector");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0}),o.Selector=o.ConfigType=void 0;var c,s=cc._decorator.ccclass,a=t("../../../common/scripts/lib/config"),l=cc._decorator.property,p=t("../../../common/scripts/lib/error-handler");(function(t){t[t.Story=0]="Story",t[t.Quiz=1]="Quiz"})(c=o.ConfigType||(o.ConfigType={}));var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.storyPage=null,e.quizPage=null,e.draw=null,e}return r(e,t),e.prototype.onLoad=function(){var t=a.default.getInstance(),e=this.processConfiguration(t.data[0]),o=cc.instantiate(this.draw);if(o.zIndex=2,this.node.addChild(o),e===c.Story){var n=cc.instantiate(this.storyPage);n.zIndex=1,this.node.addChild(n)}else if(e===c.Quiz){var r=cc.instantiate(this.quizPage);r.zIndex=1,this.node.addChild(r)}},e.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var e=[].concat.apply([],t),o=(e[0],e[1],e[2],e[3]);return e.slice(4),"S"===o?c.Story:c.Quiz},i([l(cc.Prefab)],e.prototype,"storyPage",void 0),i([l(cc.Prefab)],e.prototype,"quizPage",void 0),i([l(cc.Prefab)],e.prototype,"draw",void 0),i([p.default()],e.prototype,"onLoad",null),i([s],e)}(cc.Component);o.Selector=u,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0}],"story-page":[function(t,e,o){"use strict";cc._RF.push(e,"7d2edAAWHhOoawyDyowtMdn","story-page");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c},c=this&&this.__generator||function(t,e){var o,n,r,i,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(t){return function(e){return a([t,e])}}function a(i){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,n&&(r=2&i[0]?n.return:i[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,i[1])).done)return r;switch(n=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,n=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(r=(r=c.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=e.call(t,c)}catch(s){i=[6,s],n=0}finally{o=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},s=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,o=e&&t[e],n=0;if(o)return o.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(o,"__esModule",{value:!0}),o.StoryPage=o.LANDSCAPE=o.PORTRAIT=void 0;var a=cc._decorator.ccclass,l=cc._decorator.property,p=t("../../../common/scripts/lib/config"),u=t("./right"),h=t("../../../common/scripts/util"),f=t("../../../common/scripts/lib/error-handler"),d=t("../../../common/scripts/helper"),y=t("../../../common/scripts/chimple-richtext");o.PORTRAIT="P",o.LANDSCAPE="L";var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.landscape=null,e.portrait=null,e.word=null,e.lleft=null,e.lright=null,e.pleft=null,e.pright=null,e.nextButton=null,e.prevButton=null,e._inOrderWords=[],e._words=new Map,e._storyContent=null,e._isSideBySide=!0,e._rightComponent=null,e._storyDir=null,e._soundDir=null,e._ableToSpeakAnyIndividualClip=-1,e._imageNode=null,e._textNode=null,e.displayIterator=function(t,e,o,n){var r;return void 0===o&&(o=1/0),void 0===n&&(n=1),(r={})[Symbol.iterator]=function(){var r=!1,i=0;return{next:function(){return i=e,e=(r=e>=o)?i:e+n,{done:r,value:t[i],index:i}}}},r},e}return r(e,t),e.prototype.onLoad=function(){var t=this,e=p.default.getInstance();this._storyConfig=this.processConfiguration(e.data[0]),this._storyDir=p.default.dir+(e.lesson.id+"/res/"),this._soundDir=p.default.dir+(e.lesson.id+"/res/")+this._storyConfig.pageNo+"/",this._isSideBySide=this._storyConfig.layout===o.LANDSCAPE,this._isSideBySide?this._storyContent=cc.instantiate(this.landscape):this._storyContent=cc.instantiate(this.portrait),this.node.on(d.SOUND_LOADED_EVENT,function(){t.showText()}),this.initLayout(),this.renderNextPrevButtons()},e.prototype.renderText=function(){var t=this,e=null;if(p.default.getInstance(),this._storyConfig.text){e=this._storyConfig.layout===o.LANDSCAPE?cc.instantiate(this.lright):cc.instantiate(this.pright);var n=this._storyConfig.text.split(" ");this._rightComponent=e.getComponent(u.default),n.forEach(function(e,o){e=e.toString().replace(/"/g,""),t._inOrderWords.push(e);try{h.Util.loadGameSound(t._soundDir+o+".m4a",function(r){t._words.set(e,r),o===n.length-1&&t.node.emit(d.SOUND_LOADED_EVENT)})}catch(r){}})}return e},e.prototype.renderImage=function(){var t=null;if(this._storyConfig.image){var e=(t=this._storyConfig.layout===o.LANDSCAPE?cc.instantiate(this.lleft):cc.instantiate(this.pleft)).width,n=t.height;h.Util.loadTexture(this._storyDir+this._storyConfig.image,function(o){if(o){var r=t.getComponent(cc.Sprite);r.spriteFrame=new cc.SpriteFrame(o);var i=r.spriteFrame.getOriginalSize(),c=e/i.width,s=n/i.height,a=Math.min(c,s);t.width=a*i.width,t.height=a*i.height}})}return t},e.prototype.isTitlePage=function(){return"1"===this._storyConfig.pageNo},e.prototype.isLastPage=function(){var t=p.default.getInstance();return Number(this._storyConfig.pageNo)===t.totalProblems},e.prototype.renderNextPrevButtons=function(){p.default.getInstance();var t=null,e=null;this.isTitlePage()?(t=cc.instantiate(this.nextButton)).active=!1:this.isLastPage()?(e=cc.instantiate(this.prevButton),(t=cc.instantiate(this.nextButton)).active=!1,e.active=!1):(t=cc.instantiate(this.nextButton),e=cc.instantiate(this.prevButton),t.active=!1,e.active=!1),t&&(this.node.addChild(t),this.scheduleOnce(function(){t.active=!0},.5)),e&&(this.node.addChild(e),this.scheduleOnce(function(){e.active=!0},.5))},e.prototype.changePage=function(t){cc.audioEngine.stopAll(),cc.log("direction",t),t>0?this.node.parent.emit("nextProblem"):this.node.parent.emit("prevProblem")},e.prototype.initLayout=function(){this._isSideBySide=this._storyConfig.layout===o.LANDSCAPE,this._isSideBySide?this._storyContent=cc.instantiate(this.landscape):this._storyContent=cc.instantiate(this.portrait);var t=this.node.getChildByName("sheet");t?t.addChild(this._storyContent):this.node.addChild(this._storyContent),this._imageNode=this.renderImage(),this._textNode=this.renderText(),this.isTitlePage()?(this._storyContent.addChild(this._textNode),this._storyContent.addChild(this._imageNode)):(this._storyContent.addChild(this._imageNode),this._storyContent.addChild(this._textNode))},e.prototype.showText=function(){var t=this;if(this._textNode){var e=this.createTextToken(this._storyConfig.text);this._textNode.getComponent(y.default).string=e,this._rightComponent.storyText=JSON.parse(JSON.stringify(e)),this._rightComponent.words=this._words,this.scheduleOnce(function(){var e=t.displayIterator(t._inOrderWords,0,t._inOrderWords.length)[Symbol.iterator]();t.speakWordOneByOne(e)},1)}},e.prototype.gen=function(){return c(this,function(t){switch(t.label){case 0:return[5,s(this._inOrderWords)];case 1:return t.sent(),[2]}})},e.prototype.speakWordOneByOne=function(t){var e=this,o=t.next();if(o&&!o.done&&o.value){var n=o.value;if(this._words){var r=this._words.get(n);this.speak(n,o.index,r,function(){e._rightComponent&&e._rightComponent.noHighlight(n,o.index,"#ff0000","#000000"),e.speakWordOneByOne(t)})}}else this.speakFullSentenceWithoutHighlight()},e.prototype.speakFullSentenceWithoutHighlight=function(){var t=this,e=[];-1===this._ableToSpeakAnyIndividualClip&&(e=this._storyConfig.storySoundFile.map(function(e){return t._storyDir+e}),h.Util.speakOneByOne(e,0,function(){}))},e.prototype.speak=function(t,e,o,n){if(null!==o){var r=cc.audioEngine.playEffect(o,!1);-1!==r?(this._rightComponent&&this._rightComponent.highlight(t,e,"#000000","#ff0000",!0),this._ableToSpeakAnyIndividualClip=1,cc.audioEngine.setFinishCallback(r,n)):this.errorInSpeakClip(n)}else this.errorInSpeakClip(n)},e.prototype.errorInSpeakClip=function(t){1!==this._ableToSpeakAnyIndividualClip&&(this._ableToSpeakAnyIndividualClip=-1),this.scheduleOnce(function(){t()},.25)},e.prototype.createTextToken=function(t){return t.replace,t.split(/\s+/).map(function(t,e){return'<color="#000000" param="'+(t=t.toString().replace(/"/g,""))+"_"+e+'" click="Handler">'+t+"</color>"}).join(" ")},e.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var e=[].concat.apply([],t),o=(e[0],e[1],e[2],e[3]);return e[4],{pageNo:o,text:e[5],image:e[6],layout:e[7],storySoundFile:e[8].split(",")}},e.prototype.onDestroy=function(){cc.audioEngine.stopAll()},i([l(cc.Prefab)],e.prototype,"landscape",void 0),i([l(cc.Prefab)],e.prototype,"portrait",void 0),i([l(cc.Prefab)],e.prototype,"word",void 0),i([l(cc.Prefab)],e.prototype,"lleft",void 0),i([l(cc.Prefab)],e.prototype,"lright",void 0),i([l(cc.Prefab)],e.prototype,"pleft",void 0),i([l(cc.Prefab)],e.prototype,"pright",void 0),i([l(cc.Prefab)],e.prototype,"nextButton",void 0),i([l(cc.Prefab)],e.prototype,"prevButton",void 0),i([f.default()],e.prototype,"onLoad",null),i([f.default()],e.prototype,"renderText",null),i([f.default()],e.prototype,"renderImage",null),i([f.default()],e.prototype,"isTitlePage",null),i([f.default()],e.prototype,"isLastPage",null),i([f.default()],e.prototype,"renderNextPrevButtons",null),i([f.default()],e.prototype,"changePage",null),i([f.default()],e.prototype,"initLayout",null),i([f.default()],e.prototype,"showText",null),i([f.default()],e.prototype,"speakWordOneByOne",null),i([f.default()],e.prototype,"speakFullSentenceWithoutHighlight",null),i([f.default()],e.prototype,"speak",null),i([f.default()],e.prototype,"errorInSpeakClip",null),i([f.default()],e.prototype,"createTextToken",null),i([a],e)}(cc.Component);o.StoryPage=g,cc._RF.pop()},{"../../../common/scripts/chimple-richtext":void 0,"../../../common/scripts/helper":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./right":"right"}],"word-script":[function(t,e,o){"use strict";cc._RF.push(e,"b36ed1TDEVOB6AfUnNMv5iA","word-script");var n,r=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__decorate||function(t,e,o,n){var r,i=arguments.length,c=i<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(e,o,c):r(e,o))||c);return i>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=cc._decorator.ccclass,s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.onButtonClick=function(){},i([c],e)}(cc.Component);o.default=s,cc._RF.pop()},{}]},{},["left","nav-button","right","selector","story-page","word-script"]);