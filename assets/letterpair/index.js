window.__require=function t(e,o,i){function n(c,a){if(!o[c]){if(!e[c]){var s=c.split("/");if(s=s[s.length-1],!e[s]){var d="function"==typeof __require&&__require;if(!a&&d)return d(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+c+"'")}c=s}var l=o[c]={exports:{}};e[c][0].call(l.exports,function(t){return n(e[c][1][t]||t)},l,l.exports,t,e,o,i)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)n(i[c]);return n}({card:[function(t,e,o){"use strict";cc._RF.push(e,"74bbfoi9P1BsLbPdPwWvpFP","card");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("../../../common/scripts/util"),a=t("./letterpair"),s=t("../../../common/scripts/chimple-label"),d=t("../../../common/scripts/countingLayout"),l=t("../../../common/scripts/lessonController"),u=t("../../../common/scripts/lib/config"),p=cc._decorator,h=p.ccclass,f=p.property,g=["items/fruit/peach","items/fruit/xigua","items/fruit/avacado","items/fruit/pineapple","items/fruit/mango","items/fruit/dragonfruit","items/fruit/nuts","items/fruit/watermelon","items/fruit/cherry","items/fruit/orange","items/fruit/grapes","items/fruit/apple","items/fruit/lemon","items/fruit/banana","items/fruit/acorn","items/fruit/strawberry","items/fruit/guava","items/fruit/kiwi","items/vegetable/potato","items/vegetable/corn","items/vegetable/capsicum","items/vegetable/carrot","items/vegetable/onion","items/vegetable/tomato","items/vegetable/chilly","items/vegetable/garlic","items/vegetable/peas","items/vegetable/brinjal","items/vegetable/spinach","items/vegetable/cabbage","items/vegetable/pumpkin","items/vegetable/radish","items/vegetable/broccoli"],m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardParticle=null,e.explodeParticle=null,e.countingLayout=null,e.pickupAudio=null,e.correctAudio=null,e.wordAudio=null,e.square=null,e.rectangle=null,e.block=null,e.pairCard=null,e.particleNode=null,e.cardType=null,e.cardContent=null,e.audio=null,e.color=null,e.isInteracting=!1,e}var o;return n(e,t),o=e,e.prototype.onLoad=function(){var t=this;this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchend",this.onTouchEnd,this),this.node.on("touchcancel",this.onTouchEnd,this),this.node.on("touchmove",this.onTouchMove,this);var e=null,o=null,i="maths"==u.default.i.course.type?cc.instantiate(this.rectangle):cc.instantiate(this.square);if(e=i.getChildByName("giftbox"),o=i.getChildByName("giftboxwhite"),this.node.addChild(i),"image"==this.cardType||"rotate"==this.cardType)c.Util.loadTexture(this.cardContent,function(e){var o=new cc.Node("frontSprite"),i=o.addComponent(cc.Sprite);i.spriteFrame=new cc.SpriteFrame(e),"rotate"==t.cardType&&(o.angle=90),t.node.addChild(o),c.Util.resizeSprite(i,120,120)});else if("dice"==this.cardType)cc.resources.load("items/"+this.cardContent,cc.SpriteFrame,function(e,o){if(!e){var i=new cc.Node("frontSprite");i.addComponent(cc.Sprite).spriteFrame=o,i.scale=.9,t.node.addChild(i)}});else if("number"==this.cardType||"stick"==this.cardType){var n="number"==this.cardType?g[Math.floor(Math.random()*g.length)]:"items/shake/stick";cc.resources.load(n,cc.SpriteFrame,function(e,o){if(!e){var i=cc.instantiate(t.countingLayout),n=i.getComponent(d.default);n.fullCount=parseInt(t.cardContent),n.scale=.4,n.fullTexture=o,t.node.addChild(i)}}),0==this.audio.length&&c.Util.loadNumericSound(this.cardContent,function(e){e&&(t.wordAudio=e,t.pairCard.wordAudio=e)})}else{var r=new cc.Node("label");r.height=.5*this.node.height,r.width=.8*this.node.width;var a=r.addComponent(s.default);a.string=this.cardContent,a.horizontalAlign=cc.Label.HorizontalAlign.CENTER,a.overflow=cc.Label.Overflow.SHRINK,a.enableWrapText=!1,r.color=this.color,a.fontSize=128,a.lineHeight=150,r.position=new cc.Vec3(0,12.8),this.node.addChild(r),0==this.audio.length&&(isNaN(parseInt(this.cardContent))?c.Util.loadsLetter(this.cardContent.toLowerCase(),function(e){t.wordAudio=e}):c.Util.loadNumericSound(this.cardContent,function(e){t.wordAudio=e}))}"maths"==u.default.i.course.type&&"image"==this.cardType||"dice"==this.cardType?o.color=this.color:e.color=this.color,this.audio.length>0&&c.Util.loadGameSound(this.audio,function(e){t.wordAudio=e})},e.prototype.start=function(){var t=this.node.name.charAt(this.node.name.length-1),e=this.node.name.substr(0,this.node.name.length-1)+("1"==t?"2":"1");this.pairCard=this.node.parent.getChildByName(e).getComponent(o)},e.prototype.onDestroy=function(){this.unregisterTouch()},e.prototype.unregisterTouch=function(){this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchend",this.onTouchEnd,this),this.node.off("touchcancel",this.onTouchEnd,this),this.node.off("touchmove",this.onTouchMove,this)},e.prototype.onTouchStart=function(){this.node.parent.parent.getComponent(a.default),o.letDrag&&(o.letDrag=!1,this.isInteracting=!0,this.node.zIndex=3,c.Util.playSfx(this.pickupAudio),this.node.setSiblingIndex(this.node.parent.childrenCount-1),(new cc.Tween).target(this.node).to(.25,{scale:1.1},{progress:null,easing:"sineOut"}).start())},e.prototype.onTouchMove=function(t){this.isInteracting&&(this.node.setPosition(this.node.position.add(t.getDelta())),this.node.getBoundingBoxToWorld().intersects(this.pairCard.node.getBoundingBoxToWorld())?(this.sparkle(),null!=this.particleNode&&(this.pairCard.node.setSiblingIndex(this.node.parent.childrenCount-2),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1.1},{progress:null,easing:"elasticOut"}).start(),this.pairCard.node.zIndex=2,this.pairCard.sparkle())):(this.unSparkle(),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1},{progress:null,easing:"elasticOut"}).start(),this.pairCard.node.zIndex=0,this.pairCard.unSparkle()))},e.prototype.onTouchEnd=function(){var t=this;if(this.isInteracting)if(null!=this.particleNode){var e=cc.instantiate(this.block),i=e.getComponent(cc.Widget);null!=i&&(i.target=cc.director.getScene()),this.node.parent.addChild(e),e.opacity=224,e.zIndex=1,(new cc.Tween).target(l.default.getFriend().node).to(.25,{y:0},{progress:null,easing:"sineOut"}).call(function(){t.node.parent.parent.emit("correct")}).delay(1).to(.25,{y:-600},{progress:null,easing:"sineOut"}).start(),this.unregisterTouch(),this.unSparkle(),(new cc.Tween).target(this.node).to(.25,{position:this.pairCard.node.position,scale:1},{progress:null,easing:"elasticOut"}).delay(.5).call(function(){null!=t.wordAudio&&l.default.getFriend().speak(t.wordAudio)}).to(.5,{position:cc.v2(-this.node.width/2-20,0)},null).delay(.5).call(function(){var i=cc.instantiate(t.explodeParticle);i.position=t.node.position,t.node.parent.addChild(i);var n=t.node.parent.parent.getComponent(a.default);n.scheduleOnce(function(){e.destroy(),o.letDrag=!0,t.isInteracting=!1,n.drop(!0),t.pairCard.node.destroy(),t.node.destroy()},.25),n.scheduleOnce(function(){i.destroy()},.5)}).start(),this.pairCard.unSparkle(),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1},{progress:null,easing:"elasticOut"}).delay(.5).to(.5,{position:cc.v2(this.node.width/2+20,0)},null).delay(.5).call(function(){var e=cc.instantiate(t.explodeParticle);e.position=t.pairCard.node.position,t.node.parent.addChild(e),t.node.parent.parent.getComponent(a.default).scheduleOnce(function(){e.destroy()},.5)}).start()}else(new cc.Tween).target(l.default.getFriend().node).to(.25,{y:0},{progress:null,easing:"sineOut"}).call(function(){t.node.parent.parent.emit("wrong")}).delay(1).to(.25,{y:-600},{progress:null,easing:"sineOut"}).start(),(new cc.Tween).target(this.node).to(.25,{scale:1,position:this.node.position.clampf(new cc.Vec2(this.node.width-cc.winSize.width,this.node.height-cc.winSize.height).mul(.5),new cc.Vec2(cc.winSize.width-this.node.width,cc.winSize.height-this.node.height).mul(.5))},{progress:null,easing:"sineOut"}).call(function(){var e=t.node.parent.parent.getComponent(a.default);o.letDrag=!0,t.isInteracting=!1,t.node.zIndex=0,t.pairCard.node.zIndex=0,e.drop(!1)}).start(),this.node.parent.children.forEach(function(e){if(e!=t.node&&e.getBoundingBox().intersects(t.node.getBoundingBox())){var o=new cc.Rect;e.getBoundingBox().intersection(o,t.node.getBoundingBox());var i=new cc.Vec2(o.width/e.getBoundingBox().width,o.height/e.getBoundingBox().height),n=e.position.add(e.position.sub(t.node.position).scale(i).mul(2)).clampf(new cc.Vec2(e.getBoundingBox().width-cc.winSize.width,e.getBoundingBox().height-cc.winSize.height).mul(.5),new cc.Vec2(cc.winSize.width-e.getBoundingBox().width,cc.winSize.height-e.getBoundingBox().height).mul(.5));(new cc.Tween).target(e).to(.5,{position:n},{progress:null,easing:"quadOut"}).start()}})},e.prototype.sparkle=function(){null==this.particleNode&&(this.particleNode=cc.instantiate(this.cardParticle),this.node.addChild(this.particleNode,1,"particle"))},e.prototype.unSparkle=function(){null!=this.particleNode&&(this.node.removeChild(this.particleNode),this.particleNode=null)},e.letDrag=!0,r([f(cc.Prefab)],e.prototype,"cardParticle",void 0),r([f(cc.Prefab)],e.prototype,"explodeParticle",void 0),r([f(cc.Prefab)],e.prototype,"countingLayout",void 0),r([f({type:cc.AudioClip})],e.prototype,"pickupAudio",void 0),r([f({type:cc.AudioClip})],e.prototype,"correctAudio",void 0),r([f(cc.AudioClip)],e.prototype,"wordAudio",void 0),r([f(cc.Prefab)],e.prototype,"square",void 0),r([f(cc.Prefab)],e.prototype,"rectangle",void 0),r([f(cc.Prefab)],e.prototype,"block",void 0),o=r([h],e)}(cc.Component);o.default=m,cc._RF.pop()},{"../../../common/scripts/chimple-label":void 0,"../../../common/scripts/countingLayout":void 0,"../../../common/scripts/lessonController":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/util":void 0,"./letterpair":"letterpair"}],letterpair:[function(t,e,o){"use strict";cc._RF.push(e,"93765v8zaxLGJHiUW+Jazhw","letterpair");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./card"),a=t("../../../common/scripts/lib/config"),s=t("../../../common/scripts/util"),d=t("../../../common/scripts/lib/error-handler"),l=t("../../../common/scripts/game"),u=cc._decorator,p=u.ccclass,h=u.property,f=["#E556F4","#F1C82A","#F25949","#65179C","#45BA0F","#00CFFF","#2C3E50","#D9042B","#1FB170","#2980B9","#FF6425"],g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardPrefab=null,e.progressMonitorPrefab=null,e.totalPieces=0,e.isInteracting=!1,e}return n(e,t),e.prototype.onLoad=function(){for(var t=this,e=a.default.getInstance().data[0],o=2*Math.floor((e.length-5)/3),i=Array(o/2),n=0;n<o;n++){for(var r=Math.floor(Math.random()*o);null!=i[r];)r=(r+1)%o;i[r]=n}for(var d=(cc.winSize.width-80)/o*2,l=(cc.winSize.height-160)/2,u=0,p=e[3],h=e[4],g=0;g<o/2;g++){var m=(new cc.Color).fromHEX(f[g]),y=cc.instantiate(this.cardPrefab);y.name=u+"1";var w=y.getComponent(c.default);w.cardType=p,w.color=m,w.cardContent=e[3*g+5],w.audio=e[3*g+7],y.position=new cc.Vec2(d*(i[u]%(o/2))+Math.random()*(d-80)-cc.winSize.width/2+80,l*Math.floor(i[u]/o*2)+Math.random()*(l-80)-cc.winSize.height/2+80);var v=cc.instantiate(this.cardPrefab);v.name=u+"2",u++;var C=v.getComponent(c.default);C.cardType=h,C.color=m,C.cardContent=e[3*g+6],C.audio=e[3*g+7],v.position=new cc.Vec2(d*(i[u]%(o/2))+Math.random()*(d-80)-cc.winSize.width/2+80,l*Math.floor(i[u]/o*2)+Math.random()*(l-80)-cc.winSize.height/2+80),this.node.getChildByName("CardContainer").addChild(y),this.node.getChildByName("CardContainer").addChild(v),u++,this.totalPieces++,2==u&&s.Util.showHelp(y,v,function(){(new cc.Tween).target(t.friend.node).to(.25,{y:-600},{progress:null,easing:"sineOut"}).start()})}c.default.letDrag=!0},e.prototype.drop=function(t){this.isInteracting=!1,t&&--this.totalPieces<=0&&this.node.emit("nextProblem")},e.prototype.drag=function(){return!this.isInteracting&&(this.isInteracting=!0,!0)},r([h(cc.Prefab)],e.prototype,"cardPrefab",void 0),r([h(cc.Prefab)],e.prototype,"progressMonitorPrefab",void 0),r([d.default()],e.prototype,"onLoad",null),r([p],e)}(l.default);o.default=g,cc._RF.pop()},{"../../../common/scripts/game":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./card":"card"}]},{},["card","letterpair"]);